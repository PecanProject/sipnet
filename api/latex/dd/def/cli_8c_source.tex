\doxysection{cli.\+c}
\label{cli_8c_source}\index{cli.c@{cli.c}}
\textbf{ Go to the documentation of this file.}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#include\ "{}cli.h"{}}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#include\ "{}common/exitCodes.h"{}}}
\DoxyCodeLine{00004\ }
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ "{}version.h"{}}}
\DoxyCodeLine{00006\ }
\DoxyCodeLine{00007\ \textcolor{comment}{//\ The\ struct\ 'option'\ is\ defined\ in\ getopt.h,\ and\ is\ expected\ by\ getopt\_long()}}
\DoxyCodeLine{00008\ \textcolor{keyword}{struct\ }option\ long\_options[]\ =\ \{}
\DoxyCodeLine{00009\ \ \ \ \ \textcolor{comment}{//\ These\ options\ set\ a\ flag\ (and\ they\ need\ to\ be\ at\ the\ top\ here)}}
\DoxyCodeLine{00010\ \ \ \ \ \textcolor{comment}{//\ name\ \ \ \ \ \ \ \ \ \ \ \ \ \ has\_arg\ \ \ \ \ \ \ \ \ \ \ \ flag\ \ \ \ \ \ \ \ \ val}}
\DoxyCodeLine{00011\ \ \ \ \ \{\textcolor{stringliteral}{"{}print\_header"{}},\ no\_argument,\ \&ctx.tmpFlag,\ 1\},}
\DoxyCodeLine{00012\ \ \ \ \ \{\textcolor{stringliteral}{"{}no\_print\_header"{}},\ no\_argument,\ \&ctx.tmpFlag,\ 0\},}
\DoxyCodeLine{00013\ \ \ \ \ \{\textcolor{stringliteral}{"{}dump\_config"{}},\ no\_argument,\ \&ctx.tmpFlag,\ 1\},}
\DoxyCodeLine{00014\ \ \ \ \ \{\textcolor{stringliteral}{"{}no\_dump\_config"{}},\ no\_argument,\ \&ctx.tmpFlag,\ 0\},}
\DoxyCodeLine{00015\ \ \ \ \ \textcolor{comment}{//\ These\ options\ donâ€™t\ set\ a\ flag.\ We\ distinguish\ them\ by\ their\ indices}}
\DoxyCodeLine{00016\ \ \ \ \ \textcolor{comment}{//\ name\ \ \ \ \ \ \ \ \ \ \ \ \ \ has\_arg\ \ \ \ \ \ \ \ \ \ \ \ flag\ \ val}}
\DoxyCodeLine{00017\ \ \ \ \ \{\textcolor{stringliteral}{"{}input\_file"{}},\ required\_argument,\ 0,\ \textcolor{charliteral}{'i'}\},}
\DoxyCodeLine{00018\ \ \ \ \ \{\textcolor{stringliteral}{"{}help"{}},\ no\_argument,\ 0,\ \textcolor{charliteral}{'h'}\},}
\DoxyCodeLine{00019\ \ \ \ \ \{\textcolor{stringliteral}{"{}version"{}},\ no\_argument,\ 0,\ \textcolor{charliteral}{'v'}\},}
\DoxyCodeLine{00020\ \ \ \ \ \{0,\ 0,\ 0,\ 0\}\};}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \textcolor{comment}{//\ See\ cli.h}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#define\ NUM\_FLAG\_OPTIONS\ 4}}
\DoxyCodeLine{00024\ \textcolor{keywordtype}{char}\ *argNameMap[NUM\_FLAG\_OPTIONS]\ =\ \{}
\DoxyCodeLine{00025\ \ \ \ \ \textcolor{comment}{//\ Must\ follow\ same\ order\ as\ long\_options\ above;\ only\ need\ flag\ opts\ here}}
\DoxyCodeLine{00026\ \ \ \ \ \textcolor{comment}{//\ Gives\ corresponding\ name\ in\ Context\ struct}}
\DoxyCodeLine{00027\ \ \ \ \ \textcolor{stringliteral}{"{}printHeader"{}},\ \textcolor{stringliteral}{"{}printHeader"{}},\ \textcolor{stringliteral}{"{}dumpConfig"{}},\ \textcolor{stringliteral}{"{}dumpConfig"{}}\};}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00029\ \textcolor{comment}{//\ Print\ the\ help\ message\ when\ requested}}
\DoxyCodeLine{00030\ \textcolor{keywordtype}{void}\ usage(\textcolor{keywordtype}{char}\ *progName)\ \{}
\DoxyCodeLine{00031\ \ \ \textcolor{comment}{//\ clang-\/format\ off}}
\DoxyCodeLine{00032\ \ \ printf(\textcolor{stringliteral}{"{}Usage:\ \%s\ [OPTIONS]"{}},\ progName);}
\DoxyCodeLine{00033\ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{00034\ \ \ printf(\textcolor{stringliteral}{"{}Run\ SIPNET\ model\ for\ one\ site\ with\ configured\ options.\(\backslash\)n"{}});}
\DoxyCodeLine{00035\ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{00036\ \ \ printf(\textcolor{stringliteral}{"{}Options:\ (defaults\ are\ shown\ in\ parens\ at\ end)\(\backslash\)n"{}});}
\DoxyCodeLine{00037\ \ \ printf(\textcolor{stringliteral}{"{}\ \ -\/i,\ -\/-\/input\_file\ \ \ \ \ Name\ of\ input\ config\ file\ (sipnet.in)\(\backslash\)n"{}});}
\DoxyCodeLine{00038\ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{00039\ \ \ printf(\textcolor{stringliteral}{"{}Flag\ options:\ (prepend\ flag\ with\ 'no\_'\ to\ force\ off,\ eg\ '-\/-\/no\_print\_header')\(\backslash\)n"{}});}
\DoxyCodeLine{00040\ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{00041\ \ \ printf(\textcolor{stringliteral}{"{}\ \ -\/-\/dump\_config\ \ \ \ Print\ final\ config\ to\ <input\_file>.config\ (0)\(\backslash\)n"{}});}
\DoxyCodeLine{00042\ \ \ printf(\textcolor{stringliteral}{"{}\ \ -\/-\/print\_header\ \ \ Whether\ to\ print\ header\ row\ in\ output\ files\ (1)\(\backslash\)n"{}});}
\DoxyCodeLine{00043\ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{00044\ \ \ printf(\textcolor{stringliteral}{"{}Info\ options:\(\backslash\)n"{}});}
\DoxyCodeLine{00045\ \ \ printf(\textcolor{stringliteral}{"{}\ \ -\/h,\ -\/-\/help\ \ \ \ \ \ \ \ \ \ \ Print\ this\ message\ and\ exit\(\backslash\)n"{}});}
\DoxyCodeLine{00046\ \ \ printf(\textcolor{stringliteral}{"{}\ \ -\/v,\ -\/-\/version\ \ \ \ \ \ \ \ Print\ version\ information\ and\ exit\(\backslash\)n"{}});}
\DoxyCodeLine{00047\ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{00048\ \ \ printf(\textcolor{stringliteral}{"{}Configuration\ options\ are\ read\ from\ <input\_file>.\ Other\ options\ specified\ on\ the\ command\(\backslash\)n"{}});}
\DoxyCodeLine{00049\ \ \ printf(\textcolor{stringliteral}{"{}line\ override\ settings\ from\ that\ file.\(\backslash\)n"{}});}
\DoxyCodeLine{00050\ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{00051\ \ \ \textcolor{comment}{//printf("{}\(\backslash\)n"{});}}
\DoxyCodeLine{00052\ \ \ \textcolor{comment}{//printf("{}\(\backslash\)n"{});}}
\DoxyCodeLine{00053\ \ \ \textcolor{comment}{//\ clang-\/format\ on}}
\DoxyCodeLine{00054\ \}}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \textcolor{comment}{//\ Print\ the\ version\ when\ requested}}
\DoxyCodeLine{00057\ \textcolor{keywordtype}{void}\ version(\textcolor{keywordtype}{void})\ \{\ printf(\textcolor{stringliteral}{"{}SIPNET\ version\ \%s\(\backslash\)n"{}},\ VERSION\_STRING);\ \}}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \textcolor{comment}{//\ Parses\ command-\/line\ options\ using\ getopt\_long}}
\DoxyCodeLine{00060\ \textcolor{keywordtype}{void}\ parseCommandLineArgs(\textcolor{keywordtype}{int}\ argc,\ \textcolor{keywordtype}{char}\ *argv[])\ \{}
\DoxyCodeLine{00061\ \ \ \textcolor{comment}{/*\ getopt\_long\ stores\ the\ option\ index\ here.\ */}}
\DoxyCodeLine{00062\ \ \ \textcolor{keywordtype}{int}\ longIndex\ =\ 0;}
\DoxyCodeLine{00063\ \ \ \textcolor{keywordtype}{int}\ shortIndex;}
\DoxyCodeLine{00064\ \ \ \textcolor{comment}{//\ get\ command-\/line\ arguments:}}
\DoxyCodeLine{00065\ \ \ \textcolor{keywordflow}{while}\ ((shortIndex\ =\ getopt\_long(argc,\ argv,\ \textcolor{stringliteral}{"{}hi:v"{}},\ long\_options,}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&longIndex))\ !=\ -\/1)\ \{}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{keywordflow}{switch}\ (shortIndex)\ \{}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 0:}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ long\ form\ option,\ flag\ ==\ 0}}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ updateIntContext(argNameMap[longIndex],\ ctx.tmpFlag,\ CTX\_COMMAND\_LINE);}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \textcolor{charliteral}{'h'}:}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ usage(argv[0]);}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ exit(EXIT\_CODE\_SUCCESS);}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \textcolor{charliteral}{'i'}:}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (strlen(optarg)\ >=\ FILENAME\_MAXLEN)\ \{}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}ERROR:\ input\ filename\ \%s\ exceeds\ maximum\ length\ of\ \%d\(\backslash\)n"{}},}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ optarg,\ FILENAME\_MAXLEN);}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}Either\ change\ the\ name\ or\ increase\ INPUT\_MAXNAME\ in\ "{}}}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}frontend.c\(\backslash\)n"{}});}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \ \ exit(1);}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ updateCharContext(\textcolor{stringliteral}{"{}inputFile"{}},\ optarg,\ CTX\_COMMAND\_LINE);}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \textcolor{charliteral}{'v'}:}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ version();}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ exit(EXIT\_CODE\_SUCCESS);}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ usage(argv[0]);}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ exit(EXIT\_CODE\_BAD\_CLI\_ARGUMENT);}
\DoxyCodeLine{00092\ \ \ \ \ \}}
\DoxyCodeLine{00093\ \ \ \}}
\DoxyCodeLine{00094\ \}}

\end{DoxyCode}
