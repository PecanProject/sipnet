\doxysection{model\+Params.\+c}
\label{model_params_8c_source}\index{modelParams.c@{modelParams.c}}
\textbf{ Go to the documentation of this file.}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#include\ <stdlib.h>}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#include\ <stdio.h>}}
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#include\ <string.h>}}
\DoxyCodeLine{00004\ }
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ "{}common/context.h"{}}}
\DoxyCodeLine{00006\ }
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ "{}exitCodes.h"{}}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ "{}logging.h"{}}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ "{}modelParams.h"{}}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ "{}util.h"{}}}
\DoxyCodeLine{00011\ }
\DoxyCodeLine{00012\ \textcolor{comment}{//\ Private/helper\ functions:\ not\ defined\ in\ modelParams.h}}
\DoxyCodeLine{00013\ }
\DoxyCodeLine{00014\ \textcolor{comment}{//\ return\ 1\ if\ all\ maxParams\ parameters\ have\ been\ initialized,\ 0\ if\ not}}
\DoxyCodeLine{00015\ \textcolor{keywordtype}{int}\ allParamsInitialized(ModelParams\ *ModelParams)\ \{}
\DoxyCodeLine{00016\ \ \ \textcolor{keywordflow}{if}\ (ModelParams-\/>numParams\ ==\ ModelParams-\/>maxParams)\ \{}
\DoxyCodeLine{00017\ \ \ \ \ \textcolor{comment}{//\ all\ parameters\ have\ been\ initialized}}
\DoxyCodeLine{00018\ \ \ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{00019\ \ \ \}}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00022\ \}}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00024\ \textcolor{comment}{//\ Set\ array[0..length-\/1]\ to\ all\ be\ equal\ to\ value}}
\DoxyCodeLine{00025\ \textcolor{keywordtype}{void}\ setAll(\textcolor{keywordtype}{double}\ *array,\ \textcolor{keywordtype}{int}\ length,\ \textcolor{keywordtype}{double}\ value)\ \{}
\DoxyCodeLine{00026\ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ length;\ i++)\ \{}
\DoxyCodeLine{00029\ \ \ \ \ array[i]\ =\ value;}
\DoxyCodeLine{00030\ \ \ \}}
\DoxyCodeLine{00031\ \}}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \textcolor{comment}{//\ Checks\ to\ make\ sure\ that\ all\ parameters\ with\ isRequired=true\ have\ been\ read}}
\DoxyCodeLine{00034\ \textcolor{comment}{//\ If\ not,\ kills\ program}}
\DoxyCodeLine{00035\ \textcolor{comment}{//\ Writes\ out\ names\ of\ all\ parameters\ that\ weren't\ read\ (even\ if\ not\ required,}}
\DoxyCodeLine{00036\ \textcolor{comment}{//\ as\ a\ warning\ message)}}
\DoxyCodeLine{00037\ \textcolor{comment}{//\ Also\ prints\ out\ a\ list\ of\ obsolete\ params\ that\ were\ read}}
\DoxyCodeLine{00038\ \textcolor{keywordtype}{void}\ checkAllRead(ModelParams\ *ModelParams)\ \{}
\DoxyCodeLine{00039\ \ \ \textcolor{keywordtype}{int}\ i,\ okay,\ missingOptParam\ =\ 0;}
\DoxyCodeLine{00040\ \ \ OneModelParam\ *param;}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00042\ \ \ okay\ =\ 1;\ \ \textcolor{comment}{//\ so\ far\ so\ good}}
\DoxyCodeLine{00043\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ ModelParams-\/>numParams;\ i++)\ \{}
\DoxyCodeLine{00044\ \ \ \ \ param\ =\ \&(ModelParams-\/>params[i]);}
\DoxyCodeLine{00045\ \ \ \ \ \textcolor{keywordflow}{if}\ (!param-\/>isRead)\ \{}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (param-\/>isRequired)\ \{\ \ \textcolor{comment}{//\ should\ have\ been\ read\ but\ wasn't!}}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ okay\ =\ 0;}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ logError(\textcolor{stringliteral}{"{}Did\ not\ find\ read\ required\ parameter\ \%s\(\backslash\)n"{}},\ param-\/>name);}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ missingOptParam\ =\ 1;}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00052\ \ \ \ \ \}}
\DoxyCodeLine{00053\ \ \ \}}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00055\ \ \ \textcolor{comment}{//\ Inform\ if\ any\ optional\ params\ are\ not\ in\ the\ file;\ not\ an\ error,\ just\ a}}
\DoxyCodeLine{00056\ \ \ \textcolor{comment}{//\ note,\ and\ just\ one\ line\ instead\ of\ one\ for\ each}}
\DoxyCodeLine{00057\ \ \ \textcolor{keywordflow}{if}\ (missingOptParam)\ \{}
\DoxyCodeLine{00058\ \ \ \ \ logInfo(\textcolor{stringliteral}{"{}optional\ params\ not\ specified\ in\ input\ file:"{}});}
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{keywordflow}{if}\ (!ctx.quiet)\ \{}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ ModelParams-\/>numParams;\ i++)\ \{}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ param\ =\ \&(ModelParams-\/>params[i]);}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((!param-\/>isRead)\ \&\&\ (param-\/>isRequired\ ==\ 0))\ \{}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \ \ logWarning(\textcolor{stringliteral}{"{}\ \%s"{}},\ param-\/>name);}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00066\ \ \ \ \ \ \ logWarning(\textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{00067\ \ \ \ \ \}}
\DoxyCodeLine{00068\ \ \ \}}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \ \ \textcolor{keywordflow}{if}\ (!okay)\ \{}
\DoxyCodeLine{00071\ \ \ \ \ exit(1);}
\DoxyCodeLine{00072\ \ \ \}}
\DoxyCodeLine{00073\ \}}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00075\ \textcolor{comment}{/*************************************************/}}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \textcolor{comment}{//\ Public\ functions:\ defined\ in\ ModelParams.h}}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \textcolor{comment}{//\ allocate\ space\ for\ a\ new\ ModelParams\ structure,\ return\ a\ pointer\ to\ it}}
\DoxyCodeLine{00080\ ModelParams\ *newModelParams(\textcolor{keywordtype}{int}\ maxParams)\ \{}
\DoxyCodeLine{00081\ \ \ ModelParams\ *modelParams;}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00083\ \ \ modelParams\ =\ (ModelParams\ *)malloc(\textcolor{keyword}{sizeof}(ModelParams));}
\DoxyCodeLine{00084\ \ \ modelParams-\/>maxParams\ =\ maxParams;}
\DoxyCodeLine{00085\ \ \ modelParams-\/>numParams\ =\ 0;\ \ \textcolor{comment}{//\ for\ now,\ anyway}}
\DoxyCodeLine{00086\ \ \ modelParams-\/>numParamsRead\ =\ 0;\ \ \textcolor{comment}{//\ for\ now,\ anyway}}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \ \ \textcolor{comment}{//\ allocate\ space\ for\ vectors\ within\ this\ structure:}}
\DoxyCodeLine{00089\ \ \ modelParams-\/>params\ =}
\DoxyCodeLine{00090\ \ \ \ \ \ \ (OneModelParam\ *)malloc(maxParams\ *\ \textcolor{keyword}{sizeof}(OneModelParam));}
\DoxyCodeLine{00091\ \ \ \textcolor{comment}{//\ Allocate\ enough\ space\ for\ reading\ all\ params}}
\DoxyCodeLine{00092\ \ \ modelParams-\/>readIndices\ =\ (\textcolor{keywordtype}{int}\ *)malloc(maxParams\ *\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}));}
\DoxyCodeLine{00093\ }
\DoxyCodeLine{00094\ \ \ \textcolor{keywordflow}{return}\ modelParams;}
\DoxyCodeLine{00095\ \}}
\DoxyCodeLine{00103\ \textcolor{keywordtype}{void}\ initializeOneModelParam(ModelParams\ *modelParams,\ \textcolor{keywordtype}{char}\ *name,}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ *externalLoc,\ \textcolor{keywordtype}{int}\ isRequired)\ \{}
\DoxyCodeLine{00105\ \ \ \textcolor{keywordtype}{int}\ paramIndex;\ \ \textcolor{comment}{//\ index\ of\ next\ uninitialized\ parameter}}
\DoxyCodeLine{00106\ \ \ OneModelParam\ *param;\ \ \textcolor{comment}{//\ a\ pointer\ to\ the\ next\ uninitialized\ parameter}}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00108\ \ \ \textcolor{keywordflow}{if}\ (allParamsInitialized(modelParams))\ \{\ \ \textcolor{comment}{//\ all\ parameters\ have\ been}}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ initialized!}}
\DoxyCodeLine{00110\ \ \ \ \ logError(\textcolor{stringliteral}{"{}trying\ to\ initialize\ \%s:\ have\ already\ initialized\ all\ \%d\ "{}}}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}parameters\(\backslash\)n"{}},}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \ \ \ \ \ name,\ modelParams-\/>maxParams);}
\DoxyCodeLine{00113\ \ \ \ \ logError(\textcolor{stringliteral}{"{}Check\ value\ of\ maxParams\ passed\ into\ newModelParams\ function\(\backslash\)n"{}});}
\DoxyCodeLine{00114\ \ \ \ \ exit(1);}
\DoxyCodeLine{00115\ \ \ \}}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00117\ \ \ \textcolor{comment}{//\ otherwise,\ get\ the\ index\ of\ the\ next\ uninitialized\ parameter}}
\DoxyCodeLine{00118\ \ \ paramIndex\ =\ modelParams-\/>numParams;}
\DoxyCodeLine{00119\ \ \ \textcolor{comment}{//\ and\ set\ param\ to\ point\ to\ it\ for\ easier\ access}}
\DoxyCodeLine{00120\ \ \ param\ =\ \&(modelParams-\/>params[paramIndex]);}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ strcpy(param-\/>name,\ name);}
\DoxyCodeLine{00123\ \ \ param-\/>value\ =\ externalLoc;}
\DoxyCodeLine{00124\ \ \ param-\/>isRequired\ =\ isRequired;}
\DoxyCodeLine{00125\ \ \ param-\/>isRead\ =\ 0;}
\DoxyCodeLine{00126\ }
\DoxyCodeLine{00127\ \ \ modelParams-\/>numParams++;}
\DoxyCodeLine{00128\ \}}
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00130\ \textcolor{keywordtype}{void}\ checkParamFormat(\textcolor{keywordtype}{char}\ *line,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *sep)\ \{}
\DoxyCodeLine{00131\ \ \ \textcolor{keywordtype}{int}\ numParams\ =\ countFields(line,\ sep);}
\DoxyCodeLine{00132\ \ \ \textcolor{keywordflow}{if}\ (numParams\ >\ 2)\ \{}
\DoxyCodeLine{00133\ \ \ \ \ logWarning(\textcolor{stringliteral}{"{}extra\ columns\ in\ .param\ file\ are\ being\ ignored\ (found\ \%d\ "{}}}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}columns)\(\backslash\)n"{}},}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ numParams);}
\DoxyCodeLine{00136\ \ \ \}}
\DoxyCodeLine{00137\ \}}
\DoxyCodeLine{00138\ }
\DoxyCodeLine{00139\ \textcolor{keywordtype}{void}\ readModelParams(ModelParams\ *modelParams,\ FILE\ *paramFile)\ \{}
\DoxyCodeLine{00140\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *SEPARATORS\ =\ \textcolor{stringliteral}{"{}\ \(\backslash\)t\(\backslash\)n\(\backslash\)r"{}};\ \ \textcolor{comment}{//\ characters\ that\ can\ separate\ values}}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ in\ parameter\ files}}
\DoxyCodeLine{00142\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *COMMENT\_CHARS\ =\ \textcolor{stringliteral}{"{}!"{}};\ \ \textcolor{comment}{//\ comment\ characters\ (ignore\ everything}}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ after\ this\ on\ a\ line)}}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ \ \ \textcolor{keywordtype}{char}\ line[256];}
\DoxyCodeLine{00146\ \ \ \textcolor{keywordtype}{char}\ pName[MODEL\_PARAM\_MAXNAME];\ \ \textcolor{comment}{//\ parameter\ name}}
\DoxyCodeLine{00147\ \ \ \textcolor{keywordtype}{int}\ paramIndex;}
\DoxyCodeLine{00148\ \ \ OneModelParam\ *param;\ \ \textcolor{comment}{//\ a\ pointer\ to\ a\ single\ parameter,\ for\ easier\ access}}
\DoxyCodeLine{00149\ \ \ \textcolor{keywordtype}{char}\ strValue[32];\ \ \textcolor{comment}{//\ before\ we\ know\ whether\ value\ is\ a\ number\ or\ "{}*"{}}}
\DoxyCodeLine{00150\ \ \ \textcolor{keywordtype}{double}\ value;}
\DoxyCodeLine{00151\ \ \ \textcolor{keywordtype}{char}\ *errc;}
\DoxyCodeLine{00152\ \ \ \textcolor{keywordtype}{int}\ isComment;}
\DoxyCodeLine{00153\ \ \ \textcolor{keywordtype}{char}\ unknownParams[2048]\ =\ \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{00154\ \ \ \textcolor{keywordtype}{char}\ hasUnknownParams\ =\ 0;}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ \ \ \textcolor{comment}{//\ Check\ for\ old-\/style\ (spatial\ param)\ format\ on\ first\ line\ containing\ params}}
\DoxyCodeLine{00157\ \ \ \textcolor{keywordtype}{int}\ formatChecked\ =\ 0;}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00159\ \ \ \textcolor{keywordflow}{while}\ (fgets(line,\ \textcolor{keyword}{sizeof}(line),\ paramFile)\ !=\ NULL)\ \{\ \ \textcolor{comment}{//\ while\ not\ EOF\ or}}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ error}}
\DoxyCodeLine{00161\ \ \ \ \ \textcolor{comment}{//\ remove\ trailing\ comments:}}
\DoxyCodeLine{00162\ \ \ \ \ isComment\ =\ stripComment(line,\ COMMENT\_CHARS);}
\DoxyCodeLine{00163\ }
\DoxyCodeLine{00164\ \ \ \ \ \textcolor{keywordflow}{if}\ (!isComment)\ \{\ \ \textcolor{comment}{//\ if\ this\ isn't\ just\ a\ comment\ line\ or\ blank\ line}}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ for\ old\ spatial-\/param\ format\ and\ warn\ if\ appropriate}}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!formatChecked)\ \{}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ checkParamFormat(line,\ SEPARATORS);}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ formatChecked\ =\ 1;}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00170\ }
\DoxyCodeLine{00171\ \ \ \ \ \ \ \textcolor{comment}{//\ tokenize\ line:}}
\DoxyCodeLine{00172\ \ \ \ \ \ \ strcpy(pName,\ strtok(line,\ SEPARATORS));\ \ \textcolor{comment}{//\ copy\ first\ token\ into\ pName}}
\DoxyCodeLine{00173\ }
\DoxyCodeLine{00174\ \ \ \ \ \ \ strcpy(strValue,\ strtok(NULL,\ SEPARATORS));}
\DoxyCodeLine{00175\ }
\DoxyCodeLine{00176\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (strcmp(strValue,\ \textcolor{stringliteral}{"{}*"{}})\ ==\ 0)\ \{}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ This\ used\ to\ mean\ "{}spatially\ varying"{}\ when\ sipnet\ supported\ multiple}}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ sites,\ but\ now\ this\ is\ an\ error}}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ logError(\textcolor{stringliteral}{"{}reading\ parameter\ \%s;\ '*'\ is\ no\ longer\ supported\(\backslash\)n"{}},\ pName);}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ exit(EXIT\_CODE\_BAD\_PARAMETER\_VALUE);}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00182\ \ \ \ \ \ \ value\ =\ strtod(strValue,\ \&errc);}
\DoxyCodeLine{00183\ \ \ \ \ \ \ paramIndex\ =\ locateParam(modelParams,\ pName);}
\DoxyCodeLine{00184\ }
\DoxyCodeLine{00185\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (paramIndex\ ==\ -\/1)\ \{\ \ \textcolor{comment}{//\ not\ found}}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (hasUnknownParams)\ \{}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (strlen(unknownParams)\ +\ strlen(pName)\ >\ 2048)\ \{}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \ \ \ \ logError(\textcolor{stringliteral}{"{}Too\ many\ unknown\ params;\ please\ remove\ some\ from\ \%s\ and\ "{}}}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}rerun\(\backslash\)n"{}},}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ paramFile);}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \ \ \ \ logError(\textcolor{stringliteral}{"{}Unknown\ params\ include:\ \%s\(\backslash\)n"{}},\ unknownParams);}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \ \ \ \ exit(EXIT\_CODE\_INPUT\_FILE\_ERROR);}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \ \ strcat(unknownParams,\ \textcolor{stringliteral}{"{},\ "{}});}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \ \ strcat(unknownParams,\ pName);}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \ \ strcat(unknownParams,\ pName);}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ \ \ hasUnknownParams\ =\ 1;}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (valueSet(modelParams,\ paramIndex))\ \{}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ logError(\textcolor{stringliteral}{"{}reading\ parameter\ file:\ read\ \%s,\ but\ this\ parameter\ has\ "{}}}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}already\ been\ set\(\backslash\)n"{}},}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pName);}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ exit(EXIT\_CODE\_INPUT\_FILE\_ERROR);}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{\ \ \textcolor{comment}{//\ otherwise,\ we're\ good\ to\ go}}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ set\ param\ to\ point\ to\ the\ appropriate\ parameter,\ for\ easier\ access}}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ param\ =\ \&(modelParams-\/>params[paramIndex]);}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ *(param-\/>value)\ =\ value;}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ param-\/>isRead\ =\ 1;}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ mark\ this\ as\ the\ next\ parameter\ read\ from\ file:}}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \ \ modelParams-\/>readIndices[modelParams-\/>numParamsRead]\ =\ paramIndex;}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \ \ modelParams-\/>numParamsRead++;}
\DoxyCodeLine{00213\ \ \ \ \ \ \ \}\ \ \textcolor{comment}{//\ else\ (no\ errors\ in\ reading\ this\ line\ from\ parameter\ file)}}
\DoxyCodeLine{00214\ \ \ \ \ \}\ \ \textcolor{comment}{//\ if\ !isComment}}
\DoxyCodeLine{00215\ \ \ \}\ \ \textcolor{comment}{//\ while\ not\ EOF\ or\ error}}
\DoxyCodeLine{00216\ }
\DoxyCodeLine{00217\ \ \ \textcolor{comment}{//\ Warn\ if\ unknown\ params\ were\ found}}
\DoxyCodeLine{00218\ \ \ \textcolor{keywordflow}{if}\ (hasUnknownParams)\ \{}
\DoxyCodeLine{00219\ \ \ \ \ logWarning(\textcolor{stringliteral}{"{}Unknown\ param(s)\ found\ (and\ ignored):\ \%s\(\backslash\)n"{}},\ unknownParams);}
\DoxyCodeLine{00220\ \ \ \}}
\DoxyCodeLine{00221\ }
\DoxyCodeLine{00222\ \ \ \textcolor{comment}{//\ check\ for\ error\ in\ reading:}}
\DoxyCodeLine{00223\ \ \ \textcolor{keywordflow}{if}\ (ferror(paramFile))\ \{}
\DoxyCodeLine{00224\ \ \ \ \ logError(\textcolor{stringliteral}{"{}reading\ file\ in\ readModelParams\(\backslash\)n"{}});}
\DoxyCodeLine{00225\ \ \ \ \ logError(\textcolor{stringliteral}{"{}ferror\ =\ \%d\(\backslash\)n"{}},\ ferror(paramFile));}
\DoxyCodeLine{00226\ \ \ \ \ exit(1);}
\DoxyCodeLine{00227\ \ \ \}}
\DoxyCodeLine{00228\ }
\DoxyCodeLine{00229\ \ \ checkAllRead(modelParams);\ \ \textcolor{comment}{//\ terminate\ program\ if\ some\ required\ parameters}}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ weren't\ read}}
\DoxyCodeLine{00231\ \}\ \ \textcolor{comment}{//\ readModelParams}}
\DoxyCodeLine{00232\ }
\DoxyCodeLine{00233\ \textcolor{comment}{//\ Return\ numParams,\ the\ actual\ number\ of\ parameters\ that\ have\ been}}
\DoxyCodeLine{00234\ \textcolor{comment}{//\ initialized\ with\ initializeOneModelParam}}
\DoxyCodeLine{00235\ \textcolor{keywordtype}{int}\ getnumParams(ModelParams\ *modelParams)\ \{\ \textcolor{keywordflow}{return}\ modelParams-\/>numParams;\ \}}
\DoxyCodeLine{00236\ }
\DoxyCodeLine{00237\ \textcolor{comment}{//\ Return\ number\ of\ parameters\ that\ have\ been\ read\ in\ from\ file}}
\DoxyCodeLine{00238\ \textcolor{keywordtype}{int}\ getNumParamsRead(ModelParams\ *modelParams)\ \{}
\DoxyCodeLine{00239\ \ \ \textcolor{keywordflow}{return}\ modelParams-\/>numParamsRead;}
\DoxyCodeLine{00240\ \}}
\DoxyCodeLine{00241\ }
\DoxyCodeLine{00242\ \textcolor{comment}{//\ Find\ parameter\ with\ given\ name\ in\ the\ parameters\ vector}}
\DoxyCodeLine{00243\ \textcolor{comment}{//\ If\ found,\ return\ index\ in\ vector,\ otherwise\ return\ -\/1}}
\DoxyCodeLine{00244\ \textcolor{keywordtype}{int}\ locateParam(ModelParams\ *modelParams,\ \textcolor{keywordtype}{char}\ *name)\ \{}
\DoxyCodeLine{00245\ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{00246\ \ \ \textcolor{keywordtype}{int}\ found;}
\DoxyCodeLine{00247\ }
\DoxyCodeLine{00248\ \ \ i\ =\ 0;}
\DoxyCodeLine{00249\ \ \ found\ =\ 0;}
\DoxyCodeLine{00250\ \ \ \textcolor{keywordflow}{while}\ (i\ <\ modelParams-\/>numParams\ \&\&\ !found)\ \{}
\DoxyCodeLine{00251\ \ \ \ \ \textcolor{keywordflow}{if}\ (strcasecmp(name,\ modelParams-\/>params[i].name)\ ==\ 0)\ \{}
\DoxyCodeLine{00252\ \ \ \ \ \ \ found\ =\ 1;}
\DoxyCodeLine{00253\ \ \ \ \ \}}
\DoxyCodeLine{00254\ \ \ \ \ i++;}
\DoxyCodeLine{00255\ \ \ \}}
\DoxyCodeLine{00256\ }
\DoxyCodeLine{00257\ \ \ \textcolor{keywordflow}{if}\ (found)\ \{}
\DoxyCodeLine{00258\ \ \ \ \ \textcolor{keywordflow}{return}\ (i\ -\/\ 1);}
\DoxyCodeLine{00259\ \ \ \}}
\DoxyCodeLine{00260\ }
\DoxyCodeLine{00261\ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00262\ \}}
\DoxyCodeLine{00263\ }
\DoxyCodeLine{00264\ \textcolor{comment}{//\ Return\ 1\ if\ parameter\ i\ has\ had\ its\ value\ set,\ 0\ otherwise}}
\DoxyCodeLine{00265\ \textcolor{keywordtype}{int}\ valueSet(ModelParams\ *modelParams,\ \textcolor{keywordtype}{int}\ i)\ \{}
\DoxyCodeLine{00266\ \ \ \textcolor{keywordflow}{return}\ modelParams-\/>params[i].isRead;}
\DoxyCodeLine{00267\ \}}
\DoxyCodeLine{00268\ }
\DoxyCodeLine{00269\ \textcolor{keywordtype}{void}\ deleteModelParams(ModelParams\ *modelParams)\ \{}
\DoxyCodeLine{00270\ \ \ \textcolor{comment}{//\ Free\ space\ used\ by\ ModelParams\ structure\ itself:}}
\DoxyCodeLine{00271\ \ \ free(modelParams-\/>params);}
\DoxyCodeLine{00272\ \ \ free(modelParams-\/>readIndices);}
\DoxyCodeLine{00273\ \ \ free(modelParams);}
\DoxyCodeLine{00274\ \}}

\end{DoxyCode}
