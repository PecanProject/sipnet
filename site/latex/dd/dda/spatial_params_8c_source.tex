\doxysection{spatial\+Params.\+c}
\label{spatial_params_8c_source}\index{spatialParams.c@{spatialParams.c}}
\textbf{ Go to the documentation of this file.}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*\ spatialParams:\ structure\ and\ functions\ to\ track\ and\ manipulate\ parameters\ that\ may\ vary\ spatially}}
\DoxyCodeLine{00002\ \textcolor{comment}{\ \ \ }}
\DoxyCodeLine{00003\ \textcolor{comment}{\ \ \ Author:\ Bill\ Sacks}}
\DoxyCodeLine{00004\ \textcolor{comment}{\ \ \ }}
\DoxyCodeLine{00005\ \textcolor{comment}{\ \ \ Creation\ date:\ 8/13/04}}
\DoxyCodeLine{00006\ \textcolor{comment}{*/}}
\DoxyCodeLine{00007\ }
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ <stdlib.h>}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ <stdio.h>}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ <string.h>}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ <math.h>}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ "{}spatialParams.h"{}}\ \textcolor{comment}{//\ includes\ definition\ of\ SpatialParams\ structure,\ as\ well\ as\ OneSpatialParam\ structure}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ "{}util.h"{}}}
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \textcolor{comment}{//\ Private/helper\ functions:\ not\ defined\ in\ spatialParams.h}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{comment}{//\ return\ 1\ if\ all\ maxParameters\ parameters\ have\ been\ initialized,\ 0\ if\ not}}
\DoxyCodeLine{00019\ \textcolor{keywordtype}{int}\ allParamsInitialized(SpatialParams\ *spatialParams)\ \{}
\DoxyCodeLine{00020\ \ \ \textcolor{keywordflow}{if}\ (spatialParams-\/>numParameters\ ==\ spatialParams-\/>maxParameters)\ \textcolor{comment}{//\ all\ parameters\ have\ been\ initialized}}
\DoxyCodeLine{00021\ \ \ \ \ \textcolor{keywordflow}{return}\ 1;\ }
\DoxyCodeLine{00022\ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00023\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00024\ \}}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00027\ \textcolor{comment}{//\ Set\ array[0..length-\/1]\ to\ all\ be\ equal\ to\ value}}
\DoxyCodeLine{00028\ \textcolor{keywordtype}{void}\ setAll(\textcolor{keywordtype}{double}\ *array,\ \textcolor{keywordtype}{int}\ length,\ \textcolor{keywordtype}{double}\ value)\ \{}
\DoxyCodeLine{00029\ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ length;\ i++)}
\DoxyCodeLine{00032\ \ \ \ \ array[i]\ =\ value;}
\DoxyCodeLine{00033\ \}}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \textcolor{comment}{//\ Checks\ to\ make\ sure\ that\ all\ parameters\ with\ isRequired=true\ have\ been\ read}}
\DoxyCodeLine{00037\ \textcolor{comment}{//\ If\ not,\ kills\ program}}
\DoxyCodeLine{00038\ \textcolor{comment}{//\ Writes\ out\ names\ of\ all\ parameters\ that\ weren't\ read\ (even\ if\ not\ required,\ as\ a\ warning\ message)}}
\DoxyCodeLine{00039\ \textcolor{keywordtype}{void}\ checkAllRead(SpatialParams\ *spatialParams)\ \ \{}
\DoxyCodeLine{00040\ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{00041\ \ \ \textcolor{keywordtype}{int}\ okay;}
\DoxyCodeLine{00042\ \ \ OneSpatialParam\ *param;}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00044\ \ \ okay\ =\ 1;\ \ \textcolor{comment}{//\ so\ far\ so\ good}}
\DoxyCodeLine{00045\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ spatialParams-\/>numParameters;\ i++)\ \ \{}
\DoxyCodeLine{00046\ \ \ \ \ param\ =\ \&(spatialParams-\/>parameters[i]);}
\DoxyCodeLine{00047\ \ \ \ \ \textcolor{keywordflow}{if}\ (param-\/>value\ ==\ NULL)\ \ \{}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (param-\/>isRequired)\ \ \{\ \ \textcolor{comment}{//\ should\ have\ been\ read\ but\ wasn't!}}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ okay\ =\ 0;\ \ }
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}ERROR:\ Didn't\ read\ required\ parameter\ \%s\(\backslash\)n"{}},\ param-\/>name);}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \ \{}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}WARNING:\ Didn't\ read\ parameter\ \%s\ (not\ flagged\ as\ required,\ so\ continuing)\(\backslash\)n"{}},\ param-\/>name);}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00055\ \ \ \ \ \}}
\DoxyCodeLine{00056\ \ \ \}}
\DoxyCodeLine{00057\ \ \ }
\DoxyCodeLine{00058\ \ \ \textcolor{keywordflow}{if}\ (!okay)}
\DoxyCodeLine{00059\ \ \ \ \ exit(1);}
\DoxyCodeLine{00060\ \}}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \textcolor{comment}{/*\ If\ isSpatial\ =\ 0,\ return\ array[0]\ (ignore\ loc)}}
\DoxyCodeLine{00064\ \textcolor{comment}{\ \ \ Otherwise,\ return\ array[loc]}}
\DoxyCodeLine{00065\ \textcolor{comment}{*/}}
\DoxyCodeLine{00066\ \textcolor{keywordtype}{double}\ getPossiblySpatial(\textcolor{keywordtype}{double}\ *array,\ \textcolor{keywordtype}{int}\ loc,\ \textcolor{keywordtype}{int}\ isSpatial)\ \{}
\DoxyCodeLine{00067\ \ \ \textcolor{keywordflow}{if}\ (isSpatial)}
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{keywordflow}{return}\ array[loc];}
\DoxyCodeLine{00069\ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00070\ \ \ \ \ \textcolor{keywordflow}{return}\ array[0];}
\DoxyCodeLine{00071\ \}}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00074\ \textcolor{comment}{/*\ If\ isSpatial\ =\ 0,\ set\ array[0]\ =\ value\ (ignore\ loc)}}
\DoxyCodeLine{00075\ \textcolor{comment}{\ \ \ Otherwise,\ if\ loc\ =\ -\/1,\ set\ array[0..length-\/1]\ =\ value}}
\DoxyCodeLine{00076\ \textcolor{comment}{\ \ \ Otherwise,\ set\ array[loc]\ =\ value}}
\DoxyCodeLine{00077\ \textcolor{comment}{*/}}
\DoxyCodeLine{00078\ \textcolor{keywordtype}{void}\ setPossiblySpatial(\textcolor{keywordtype}{double}\ *array,\ \textcolor{keywordtype}{int}\ loc,\ \textcolor{keywordtype}{double}\ value,\ \textcolor{keywordtype}{int}\ isSpatial,\ \textcolor{keywordtype}{int}\ length)\ \{}
\DoxyCodeLine{00079\ \ \ \textcolor{keywordflow}{if}\ (isSpatial)\ \{}
\DoxyCodeLine{00080\ \ \ \ \ \textcolor{keywordflow}{if}\ (loc\ ==\ -\/1)}
\DoxyCodeLine{00081\ \ \ \ \ \ \ setAll(array,\ length,\ value);}
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00083\ \ \ \ \ \ \ array[loc]\ =\ value;}
\DoxyCodeLine{00084\ \ \ \}}
\DoxyCodeLine{00085\ \ \ \textcolor{keywordflow}{else}\ \textcolor{comment}{//\ non-\/spatial}}
\DoxyCodeLine{00086\ \ \ \ \ array[0]\ =\ value;}
\DoxyCodeLine{00087\ \}}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ \textcolor{comment}{/*\ Read\ array\ of\ spatial\ values\ from\ file,\ for\ a\ single\ parameter}}
\DoxyCodeLine{00091\ \textcolor{comment}{\ \ \ Values\ are\ returned\ in\ the\ array\ spatialValues,\ which\ must\ be\ at\ least\ of\ length\ numLocs}}
\DoxyCodeLine{00092\ \textcolor{comment}{\ \ \ spatialParamFile\ is\ the\ (already-\/open)\ file\ of\ spatial\ parameters}}
\DoxyCodeLine{00093\ \textcolor{comment}{\ \ \ \ -\/\ the\ file\ pointer\ should\ be\ pointing\ to\ the\ start\ of\ the\ line\ we\ want\ to\ read}}
\DoxyCodeLine{00094\ \textcolor{comment}{\ \ \ pName\ gives\ the\ name\ of\ the\ parameter;\ we'll\ abort\ if\ the\ next\ parameter\ does\ not\ have\ the\ name\ given\ by\ pName}}
\DoxyCodeLine{00095\ \textcolor{comment}{\ \ \ numLocs\ is\ the\ number\ of\ values\ to\ read}}
\DoxyCodeLine{00096\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00097\ \textcolor{keywordtype}{void}\ readSpatialValues(\textcolor{keywordtype}{double}\ *spatialValues,\ FILE\ *spatialParamFile,\ \textcolor{keywordtype}{char}\ pName[PARAM\_MAXNAME],\ \textcolor{keywordtype}{int}\ numLocs)\ \ \{}
\DoxyCodeLine{00098\ \ \ \textcolor{keywordtype}{char}\ pNameSpatial[PARAM\_MAXNAME];}
\DoxyCodeLine{00099\ \ \ \textcolor{keywordtype}{int}\ status;}
\DoxyCodeLine{00100\ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00102\ \ \ \textcolor{comment}{//\ read\ name\ from\ spatialParamFile,\ make\ sure\ it's\ what\ we\ expect:}}
\DoxyCodeLine{00103\ \ \ status\ =\ fscanf(spatialParamFile,\ \textcolor{stringliteral}{"{}\%s"{}},\ pNameSpatial);}
\DoxyCodeLine{00104\ \ \ \textcolor{keywordflow}{if}\ (status\ ==\ EOF\ ||\ status\ ==\ 0)\ \{\ \textcolor{comment}{//\ error\ reading}}
\DoxyCodeLine{00105\ \ \ \ \ printf(\textcolor{stringliteral}{"{}Error\ trying\ to\ read\ \%s\ from\ spatialParamFile\(\backslash\)n"{}},\ pName);}
\DoxyCodeLine{00106\ \ \ \ \ exit(1);}
\DoxyCodeLine{00107\ \ \ \}}
\DoxyCodeLine{00108\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (strcmpIgnoreCase(pName,\ pNameSpatial)\ !=\ 0)\ \{\ \textcolor{comment}{//\ compare,\ ignore\ case}}
\DoxyCodeLine{00109\ \ \ \ \ printf(\textcolor{stringliteral}{"{}Error:\ read\ \%s\ from\ spatialParamFile,\ expected\ \%s\(\backslash\)n"{}},\ pNameSpatial,\ pName);}
\DoxyCodeLine{00110\ \ \ \ \ exit(1);}
\DoxyCodeLine{00111\ \ \ \}}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00113\ \ \ \textcolor{comment}{//\ now\ read\ values\ and\ assign\ param-\/>value,\ guess,\ best,\ and\ knob:}}
\DoxyCodeLine{00114\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ numLocs;\ i++)\ \{}
\DoxyCodeLine{00115\ \ \ \ \ status\ =\ fscanf(spatialParamFile,\ \textcolor{stringliteral}{"{}\%lf"{}},\ \&(spatialValues[i]));}
\DoxyCodeLine{00116\ \ \ \ \ \textcolor{keywordflow}{if}\ (status\ ==\ EOF\ ||\ status\ ==\ 0)\ \{\ \textcolor{comment}{//\ error\ reading}}
\DoxyCodeLine{00117\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}Error:\ did\ not\ find\ enough\ values\ in\ spatialParamFile\ for\ \%s\(\backslash\)n"{}},\ pName);}
\DoxyCodeLine{00118\ \ \ \ \ \ \ exit(1);}
\DoxyCodeLine{00119\ \ \ \ \ \}}
\DoxyCodeLine{00120\ \ \ \}}
\DoxyCodeLine{00121\ \ \ \ \ }
\DoxyCodeLine{00122\ \}}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ \textcolor{comment}{/*************************************************/}}
\DoxyCodeLine{00126\ }
\DoxyCodeLine{00127\ \textcolor{comment}{//\ Public\ functions:\ defined\ in\ spatialParams.h}}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00130\ \textcolor{comment}{//\ allocate\ space\ for\ a\ new\ spatialParams\ structure,\ return\ a\ pointer\ to\ it}}
\DoxyCodeLine{00131\ SpatialParams\ *newSpatialParams(\textcolor{keywordtype}{int}\ maxParameters,\ \textcolor{keywordtype}{int}\ numLocs)\ \{}
\DoxyCodeLine{00132\ \ \ SpatialParams\ *spatialParams;}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00134\ \ \ spatialParams\ =\ (SpatialParams\ *)malloc(\textcolor{keyword}{sizeof}(SpatialParams));}
\DoxyCodeLine{00135\ \ \ spatialParams-\/>maxParameters\ =\ maxParameters;}
\DoxyCodeLine{00136\ \ \ spatialParams-\/>numParameters\ =\ 0;\ \ \textcolor{comment}{//\ for\ now,\ anyway}}
\DoxyCodeLine{00137\ \ \ spatialParams-\/>numParamsRead\ =\ 0;\ \ \textcolor{comment}{//\ for\ now,\ anyway}}
\DoxyCodeLine{00138\ \ \ spatialParams-\/>numLocs\ =\ numLocs;}
\DoxyCodeLine{00139\ \ \ spatialParams-\/>numChangeableParams\ =\ 0;\ \textcolor{comment}{//\ for\ now,\ anyway}}
\DoxyCodeLine{00140\ \ \ }
\DoxyCodeLine{00141\ \ \ \textcolor{comment}{//\ allocate\ space\ for\ vectors\ within\ this\ structure:}}
\DoxyCodeLine{00142\ \ \ spatialParams-\/>parameters\ =\ (OneSpatialParam\ *)malloc(maxParameters\ *\ \textcolor{keyword}{sizeof}(OneSpatialParam));}
\DoxyCodeLine{00143\ \ \ spatialParams-\/>readIndices\ =\ (\textcolor{keywordtype}{int}\ *)malloc(maxParameters\ *\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}));\ \ \textcolor{comment}{//\ the\ biggest\ it\ could\ have\ to\ be}}
\DoxyCodeLine{00144\ \ \ spatialParams-\/>changeableParamIndices\ =\ (\textcolor{keywordtype}{int}\ *)malloc(maxParameters\ *\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}));\ \textcolor{comment}{//\ the\ biggest\ it\ could\ have\ to\ be}}
\DoxyCodeLine{00145\ }
\DoxyCodeLine{00146\ \ \ \textcolor{keywordflow}{return}\ spatialParams;}
\DoxyCodeLine{00147\ \}}
\DoxyCodeLine{00148\ \ }
\DoxyCodeLine{00149\ \ }
\DoxyCodeLine{00150\ \textcolor{comment}{/*\ Initialize\ next\ spatial\ parameter:}}
\DoxyCodeLine{00151\ \textcolor{comment}{\ \ \ Set\ name\ of\ parameter\ equal\ to\ "{}name"{},\ }}
\DoxyCodeLine{00152\ \textcolor{comment}{\ \ \ \ and\ set\ parameter's\ externalLoc\ pointer\ to\ point\ to\ the\ location\ given\ by\ "{}externalLoc"{}\ parameter}}
\DoxyCodeLine{00153\ \textcolor{comment}{\ \ \ \ Also\ set\ parameter's\ isRequired\ value:\ if\ true,\ then\ we'll\ terminate\ execution\ if\ this\ parameter\ is\ not\ read\ from\ file}}
\DoxyCodeLine{00154\ \textcolor{comment}{\ \ \ Note:\ acceptable\ to\ have\ externalLoc\ =\ NULL,\ but\ then\ it\ won't\ be\ assigned\ by\ loadSpatialParams}}
\DoxyCodeLine{00155\ \textcolor{comment}{*/}}
\DoxyCodeLine{00156\ \textcolor{keywordtype}{void}\ initializeOneSpatialParam(SpatialParams\ *spatialParams,\ \textcolor{keywordtype}{char}\ *name,\ \textcolor{keywordtype}{double}\ *externalLoc,\ \textcolor{keywordtype}{int}\ isRequired)\ \ \{}
\DoxyCodeLine{00157\ \ \ \textcolor{keywordtype}{int}\ paramIndex;\ \ \textcolor{comment}{//\ index\ of\ next\ uninitialized\ parameter}}
\DoxyCodeLine{00158\ \ \ OneSpatialParam\ *param;\ \textcolor{comment}{//\ a\ pointer\ to\ the\ next\ uninitialized\ parameter}}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00160\ \ \ \textcolor{keywordflow}{if}\ (allParamsInitialized(spatialParams))\ \ \{\ \ \textcolor{comment}{//\ all\ parameters\ have\ been\ initialized!}}
\DoxyCodeLine{00161\ \ \ \ \ printf(\textcolor{stringliteral}{"{}Error\ trying\ to\ initialize\ \%s:\ have\ already\ initialized\ all\ \%d\ parameters\(\backslash\)n"{}},\ name,\ spatialParams-\/>maxParameters);}
\DoxyCodeLine{00162\ \ \ \ \ printf(\textcolor{stringliteral}{"{}Check\ value\ of\ maxParameters\ passed\ into\ newSpatialParams\ function\(\backslash\)n"{}});}
\DoxyCodeLine{00163\ \ \ \ \ exit(1);}
\DoxyCodeLine{00164\ \ \ \}}
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00166\ \ \ \textcolor{comment}{//\ otherwise,\ get\ the\ index\ of\ the\ next\ uninitialized\ parameter}}
\DoxyCodeLine{00167\ \ \ paramIndex\ =\ spatialParams-\/>numParameters;}
\DoxyCodeLine{00168\ \ \ \textcolor{comment}{//\ and\ set\ param\ to\ point\ to\ it\ for\ easier\ access}}
\DoxyCodeLine{00169\ \ \ param\ =\ \&(spatialParams-\/>parameters[paramIndex]);}
\DoxyCodeLine{00170\ }
\DoxyCodeLine{00171\ \ \ strcpy(param-\/>name,\ name);}
\DoxyCodeLine{00172\ \ \ param-\/>externalLoc\ =\ externalLoc;}
\DoxyCodeLine{00173\ \ \ param-\/>isRequired\ =\ isRequired;}
\DoxyCodeLine{00174\ }
\DoxyCodeLine{00175\ \ \ \textcolor{comment}{//\ set\ value\ pointer\ to\ be\ NULL\ (this\ will\ mark\ unread\ parameter)}}
\DoxyCodeLine{00176\ \ \ param-\/>value\ =\ NULL;}
\DoxyCodeLine{00177\ }
\DoxyCodeLine{00178\ \ \ spatialParams-\/>numParameters++;}
\DoxyCodeLine{00179\ \}}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00181\ }
\DoxyCodeLine{00182\ \textcolor{comment}{/*\ Read\ all\ parameters\ from\ file,\ setting\ all\ values\ in\ spatialParams\ structure\ appropriately}}
\DoxyCodeLine{00183\ \textcolor{comment}{\ \ \ }}
\DoxyCodeLine{00184\ \textcolor{comment}{\ \ \ Structure\ of\ paramFile:}}
\DoxyCodeLine{00185\ \textcolor{comment}{\ \ \ \ \ \ name\ \ value\ \ changeable\ \ min\ \ max\ \ sigma}}
\DoxyCodeLine{00186\ \textcolor{comment}{\ \ \ where\ value\ is\ a\ number\ if\ parameter\ is\ non-\/spatial,\ or\ *\ if\ parameter\ is\ spatial;\ changeable\ is\ 0\ or\ 1\ (boolean)}}
\DoxyCodeLine{00187\ \textcolor{comment}{\ \ \ If\ parameter\ is\ spatial,\ look\ in\ spatialParamFile\ for\ value,\ which\ has\ the\ following\ structure:}}
\DoxyCodeLine{00188\ \textcolor{comment}{\ \ \ \ \ \ name\ \ value\ \ [value\ \ value...]}}
\DoxyCodeLine{00189\ \textcolor{comment}{\ \ \ where\ the\ number\ of\ values\ is\ equal\ to\ the\ number\ of\ spatial\ locations}}
\DoxyCodeLine{00190\ \textcolor{comment}{}}
\DoxyCodeLine{00191\ \textcolor{comment}{\ \ \ The\ order\ of\ the\ parameters\ in\ paramFile\ does\ not\ matter,}}
\DoxyCodeLine{00192\ \textcolor{comment}{\ \ \ \ but\ parameters\ must\ be\ specified\ in\ the\ same\ order\ in\ paramFile\ and\ spatialParamFile}}
\DoxyCodeLine{00193\ \textcolor{comment}{}}
\DoxyCodeLine{00194\ \textcolor{comment}{\ \ \ !\ is\ a\ comment\ character\ in\ paramFile:\ anything\ after\ a\ !\ on\ a\ line\ is\ ignored\ }}
\DoxyCodeLine{00195\ \textcolor{comment}{\ \ \ \ note,\ though,\ that\ comments\ are\ not\ currently\ allowed\ in\ spatialParamFile}}
\DoxyCodeLine{00196\ \textcolor{comment}{}}
\DoxyCodeLine{00197\ \textcolor{comment}{\ \ \ PRE:\ paramFile\ is\ open\ and\ file\ pointer\ points\ to\ start\ of\ file}}
\DoxyCodeLine{00198\ \textcolor{comment}{\ \ \ \ \ \ \ \ spatialParamFile\ is\ open\ and\ file\ pointer\ points\ to\ 2nd\ line\ (after\ the\ numLocs\ line)}}
\DoxyCodeLine{00199\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00200\ \textcolor{keywordtype}{void}\ readSpatialParams(SpatialParams\ *spatialParams,\ FILE\ *paramFile,\ FILE\ *spatialParamFile)\ \ \{}
\DoxyCodeLine{00201\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *SEPARATORS\ =\ \textcolor{stringliteral}{"{}\ \(\backslash\)t\(\backslash\)n\(\backslash\)r"{}};\ \textcolor{comment}{//\ characters\ that\ can\ separate\ values\ in\ parameter\ files}}
\DoxyCodeLine{00202\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *COMMENT\_CHARS\ =\ \textcolor{stringliteral}{"{}!"{}};\ \ \textcolor{comment}{//\ comment\ characters\ (ignore\ everything\ after\ this\ on\ a\ line)}}
\DoxyCodeLine{00203\ }
\DoxyCodeLine{00204\ \ \ \textcolor{keywordtype}{char}\ line[256];}
\DoxyCodeLine{00205\ \ \ \textcolor{keywordtype}{char}\ pName[PARAM\_MAXNAME];\ \ \textcolor{comment}{//\ parameter\ name}}
\DoxyCodeLine{00206\ \ \ \textcolor{keywordtype}{int}\ paramIndex;\ \ }
\DoxyCodeLine{00207\ \ \ OneSpatialParam\ *param;\ \textcolor{comment}{//\ a\ pointer\ to\ a\ single\ parameter,\ for\ easier\ access}}
\DoxyCodeLine{00208\ \ \ \textcolor{keywordtype}{char}\ strValue[32];\ \textcolor{comment}{//\ before\ we\ know\ whether\ value\ is\ a\ number\ or\ "{}*"{}}}
\DoxyCodeLine{00209\ \ \ \textcolor{keywordtype}{double}\ value,\ min,\ max,\ sigma;}
\DoxyCodeLine{00210\ \ \ \textcolor{keywordtype}{double}\ *spatialValues;\ \ \textcolor{comment}{//\ temporary\ storage\ for\ values\ read\ from\ spatial\ param\ file}}
\DoxyCodeLine{00211\ \ \ \textcolor{keywordtype}{int}\ changeable,\ spatiallyVarying;\ \ \textcolor{comment}{//\ is\ the\ parameter\ changeable?\ is\ it\ spatially-\/varying?}}
\DoxyCodeLine{00212\ \ \ \textcolor{keywordtype}{char}\ *errc;}
\DoxyCodeLine{00213\ \ \ \textcolor{keywordtype}{int}\ isComment;}
\DoxyCodeLine{00214\ \ \ \textcolor{keywordtype}{int}\ numLocs,\ i;}
\DoxyCodeLine{00215\ }
\DoxyCodeLine{00216\ \ \ numLocs\ =\ spatialParams-\/>numLocs;\ \ \textcolor{comment}{//\ for\ those\ parameters\ that\ are\ spatially-\/varying}}
\DoxyCodeLine{00217\ \ \ spatialValues\ =\ (\textcolor{keywordtype}{double}\ *)malloc(numLocs\ *\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{double}));}
\DoxyCodeLine{00218\ }
\DoxyCodeLine{00219\ \ \ \textcolor{keywordflow}{while}\ (fgets(line,\ \textcolor{keyword}{sizeof}(line),\ paramFile)\ !=\ NULL)\ \ \{\ \ \textcolor{comment}{//\ while\ not\ EOF\ or\ error}}
\DoxyCodeLine{00220\ \ \ \ \ \textcolor{comment}{//\ remove\ trailing\ comments:}}
\DoxyCodeLine{00221\ \ \ \ \ isComment\ =\ stripComment(line,\ COMMENT\_CHARS);}
\DoxyCodeLine{00222\ }
\DoxyCodeLine{00223\ \ \ \ \ \textcolor{keywordflow}{if}\ (!isComment)\ \ \{\ \ \textcolor{comment}{//\ if\ this\ isn't\ just\ a\ comment\ line\ or\ blank\ line\ \ \ \ }}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \textcolor{comment}{//\ tokenize\ line:}}
\DoxyCodeLine{00225\ \ \ \ \ \ \ strcpy(pName,\ strtok(line,\ SEPARATORS));\ \textcolor{comment}{//\ copy\ first\ token\ into\ pName}}
\DoxyCodeLine{00226\ \ \ \ \ \ \ strcpy(strValue,\ strtok(NULL,\ SEPARATORS));\ \textcolor{comment}{//\ copy\ next\ token\ into\ strValue;\ wait\ until\ later\ to\ figure\ out\ if\ it's\ "{}*"{}\ or\ a\ number}}
\DoxyCodeLine{00227\ \ \ \ \ \ \ changeable\ =\ strtol(strtok(NULL,\ SEPARATORS),\ \&errc,\ 0);}
\DoxyCodeLine{00228\ \ \ \ \ \ \ min\ =\ strtod(strtok(NULL,\ SEPARATORS),\ \&errc);}
\DoxyCodeLine{00229\ \ \ \ \ \ \ max\ =\ strtod(strtok(NULL,\ SEPARATORS),\ \&errc);}
\DoxyCodeLine{00230\ \ \ \ \ \ \ sigma\ =\ strtod(strtok(NULL,\ SEPARATORS),\ \&errc);}
\DoxyCodeLine{00231\ }
\DoxyCodeLine{00232\ \ \ \ \ \ \ \textcolor{comment}{//\ now\ we\ need\ to\ see\ if\ we\ read\ in\ an\ actual\ value,\ or\ a\ "{}*"{}\ (if\ the\ latter,\ it's\ a\ spatially-\/varying\ parameter)}}
\DoxyCodeLine{00233\ \ \ \ \ \ \ \textcolor{comment}{//\ note\ that\ we\ read\ this\ before\ doing\ the\ error\ checking\ on\ paramIndex:}}
\DoxyCodeLine{00234\ \ \ \ \ \ \ \textcolor{comment}{//\ \ that\ way,\ even\ if\ we\ ignore\ this\ parameter,\ we've\ still\ read\ (and\ ignored)\ the\ corresponding\ line\ in\ the\ spatial\ param\ file,\ if\ it's\ a\ spatially-\/varying\ parameter}}
\DoxyCodeLine{00235\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (strcmp(strValue,\ \textcolor{stringliteral}{"{}*"{}})\ ==\ 0)\ \{\ \textcolor{comment}{//\ we\ read\ "{}*"{}:\ this\ is\ a\ spatially-\/varying\ parameter}}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \ \ readSpatialValues(spatialValues,\ spatialParamFile,\ pName,\ numLocs);}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ spatiallyVarying\ =\ 1;}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ spatiallyVarying\ =\ 0;}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00242\ }
\DoxyCodeLine{00243\ \ \ \ \ \ \ paramIndex\ =\ locateParam(spatialParams,\ pName);}
\DoxyCodeLine{00244\ }
\DoxyCodeLine{00245\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (paramIndex\ ==\ -\/1)\ \ \{\ \ \textcolor{comment}{//\ not\ found}}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}WARNING:\ Ignoring\ parameter\ \%s:\ this\ parameter\ wasn't\ initialized\ in\ the\ code\(\backslash\)n"{}},\ pName);}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (valueSet(spatialParams,\ paramIndex))\ \ \{}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}Error\ reading\ parameter\ file:\ read\ \%s,\ but\ this\ parameter\ has\ already\ been\ set\(\backslash\)n"{}},\ pName);}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ exit(1);}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \ \{\ \ \ \textcolor{comment}{//\ otherwise,\ we're\ good\ to\ go}}
\DoxyCodeLine{00253\ \ \ \ \ \ \ }
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ set\ param\ to\ point\ to\ the\ appropriate\ parameter,\ for\ easier\ access}}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ param\ =\ \&(spatialParams-\/>parameters[paramIndex]);}
\DoxyCodeLine{00256\ }
\DoxyCodeLine{00257\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ mark\ this\ as\ the\ next\ parameter\ read\ from\ file:}}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ spatialParams-\/>readIndices[spatialParams-\/>numParamsRead]\ =\ paramIndex;}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \ \ spatialParams-\/>numParamsRead++;}
\DoxyCodeLine{00260\ }
\DoxyCodeLine{00261\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ fill\ the\ new\ spatialParam\ structure\ with\ changeable,\ min,\ max,\ and\ sigma}}
\DoxyCodeLine{00262\ \ \ \ \ \ \ \ \ param-\/>isChangeable\ =\ changeable;}
\DoxyCodeLine{00263\ \ \ \ \ \ \ \ \ param-\/>min\ =\ min;}
\DoxyCodeLine{00264\ \ \ \ \ \ \ \ \ param-\/>max\ =\ max;}
\DoxyCodeLine{00265\ \ \ \ \ \ \ \ \ param-\/>sigma\ =\ sigma;}
\DoxyCodeLine{00266\ }
\DoxyCodeLine{00267\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (changeable)\ \{\ \textcolor{comment}{//\ we\ need\ to\ update\ info\ on\ changeable\ params\ in\ spatialParams}}
\DoxyCodeLine{00268\ \ \ \ \ \ \ \ \ \ \ spatialParams-\/>changeableParamIndices[spatialParams-\/>numChangeableParams]\ =\ paramIndex;}
\DoxyCodeLine{00269\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ before\ we\ change\ it,\ spatialParams-\/>numChangeableParams\ is\ the\ index\ of\ the\ first\ free\ spot\ in\ the\ changeableParamIndices\ vector}}
\DoxyCodeLine{00270\ \ \ \ \ \ \ \ \ \ \ spatialParams-\/>numChangeableParams++;}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00272\ \ \ }
\DoxyCodeLine{00273\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (spatiallyVarying)\ \{\ }
\DoxyCodeLine{00274\ \ \ \ \ \ \ \ \ \ \ param-\/>numLocs\ =\ numLocs;}
\DoxyCodeLine{00275\ }
\DoxyCodeLine{00276\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ allocate\ space:}}
\DoxyCodeLine{00277\ \ \ \ \ \ \ \ \ \ \ param-\/>value\ =\ (\textcolor{keywordtype}{double}\ *)malloc(numLocs\ *\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{double}));}
\DoxyCodeLine{00278\ \ \ \ \ \ \ \ \ \ \ param-\/>guess\ =\ (\textcolor{keywordtype}{double}\ *)malloc(numLocs\ *\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{double}));}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ \ \ param-\/>best\ =\ (\textcolor{keywordtype}{double}\ *)malloc(numLocs\ *\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{double}));}
\DoxyCodeLine{00280\ \ \ \ \ \ \ \ \ \ \ param-\/>knob\ =\ (\textcolor{keywordtype}{double}\ *)malloc(numLocs\ *\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{double}));}
\DoxyCodeLine{00281\ }
\DoxyCodeLine{00282\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ now\ assign\ param-\/>value,\ guess,\ best,\ and\ knob\ (these\ were\ read\ above,\ in\ call\ to\ readSpatialValues):}}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ numLocs;\ i++)\ \{}
\DoxyCodeLine{00284\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ assign\ value,\ guess\ and\ best\ to\ all\ be\ the\ guess\ value\ initially:}}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ \ \ \ \ param-\/>value[i]\ =\ param-\/>guess[i]\ =\ param-\/>best[i]\ =\ spatialValues[i];}
\DoxyCodeLine{00286\ \ \ \ \ \ \ \ \ \ \ \ \ param-\/>knob[i]\ =\ 0;\ \textcolor{comment}{//\ assign\ knob\ to\ be\ 0\ initially}}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{comment}{//\ for\ i}}
\DoxyCodeLine{00288\ \ \ \ \ \ \ \ \ \}\ \textcolor{comment}{//\ if\ spatially-\/varying}}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{\ \textcolor{comment}{//\ non-\/spatially-\/varying\ parameter}}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \ \ \ \ param-\/>numLocs\ =\ 0;\ \textcolor{comment}{//\ signifies\ non-\/spatially-\/varying}}
\DoxyCodeLine{00291\ \ \ \ \ }
\DoxyCodeLine{00292\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ allocate\ space\ for\ a\ single\ value\ in\ each\ of\ param-\/>value,\ guess,\ best\ and\ knob:}}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ \ \ param-\/>value\ =\ (\textcolor{keywordtype}{double}\ *)malloc(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{double}));}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ \ \ param-\/>guess\ =\ (\textcolor{keywordtype}{double}\ *)malloc(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{double}));}
\DoxyCodeLine{00295\ \ \ \ \ \ \ \ \ \ \ param-\/>best\ =\ (\textcolor{keywordtype}{double}\ *)malloc(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{double}));}
\DoxyCodeLine{00296\ \ \ \ \ \ \ \ \ \ \ param-\/>knob\ =\ (\textcolor{keywordtype}{double}\ *)malloc(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{double}));}
\DoxyCodeLine{00297\ }
\DoxyCodeLine{00298\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ assign\ value,\ guess\ and\ best\ to\ all\ be\ the\ guess\ value\ initially:}}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \ \ \ \ value\ =\ strtod(strValue,\ \&errc);\ \textcolor{comment}{//\ convert\ string\ value\ to\ double}}
\DoxyCodeLine{00300\ \ \ \ \ \ \ \ \ \ \ param-\/>value[0]\ =\ param-\/>guess[0]\ =\ param-\/>best[0]\ =\ value;}
\DoxyCodeLine{00301\ \ \ \ \ \ \ \ \ \ \ param-\/>knob[0]\ =\ 0;\ \textcolor{comment}{//\ assign\ knob\ to\ be\ 0\ initially}}
\DoxyCodeLine{00302\ \ \ \ \ \ \ \ \ \}\ \textcolor{comment}{//\ else\ non-\/spatially-\/varying}}
\DoxyCodeLine{00303\ \ \ \ \ \ \ \}\ \textcolor{comment}{//\ else\ (no\ errors\ in\ reading\ this\ line\ from\ parameter\ file)}}
\DoxyCodeLine{00304\ \ \ \ \ \}\ \ \textcolor{comment}{//\ if\ !isComment}}
\DoxyCodeLine{00305\ \ \ \}\ \ \textcolor{comment}{//\ while\ not\ EOF\ or\ error}}
\DoxyCodeLine{00306\ \ \ }
\DoxyCodeLine{00307\ \ \ \textcolor{comment}{//\ check\ for\ error\ in\ reading:}}
\DoxyCodeLine{00308\ \ \ \textcolor{keywordflow}{if}\ (ferror(paramFile))\ \ \{}
\DoxyCodeLine{00309\ \ \ \ \ printf(\textcolor{stringliteral}{"{}Error\ reading\ file\ in\ readSpatialParams\(\backslash\)n"{}});}
\DoxyCodeLine{00310\ \ \ \ \ printf(\textcolor{stringliteral}{"{}ferror\ =\ \%d\(\backslash\)n"{}},\ ferror(paramFile));}
\DoxyCodeLine{00311\ \ \ \ \ exit(1);}
\DoxyCodeLine{00312\ \ \ \}}
\DoxyCodeLine{00313\ }
\DoxyCodeLine{00314\ \ \ checkAllRead(spatialParams);\ \ \textcolor{comment}{//\ terminate\ program\ if\ some\ required\ parameters\ weren't\ read}}
\DoxyCodeLine{00315\ }
\DoxyCodeLine{00316\ \ \ free(spatialValues);}
\DoxyCodeLine{00317\ \}\ \ \textcolor{comment}{//\ readSpatialParams}}
\DoxyCodeLine{00318\ }
\DoxyCodeLine{00319\ }
\DoxyCodeLine{00320\ \textcolor{comment}{//\ Return\ numParameters,\ the\ actual\ number\ of\ parameters\ that\ have\ been\ initialized\ with\ initializeOneSpatialParam}}
\DoxyCodeLine{00321\ \textcolor{keywordtype}{int}\ getNumParameters(SpatialParams\ *spatialParams)\ \ \{}
\DoxyCodeLine{00322\ \ \ \textcolor{keywordflow}{return}\ spatialParams-\/>numParameters;}
\DoxyCodeLine{00323\ \}}
\DoxyCodeLine{00324\ }
\DoxyCodeLine{00325\ }
\DoxyCodeLine{00326\ \textcolor{comment}{//\ Return\ number\ of\ parameters\ that\ have\ been\ read\ in\ from\ file}}
\DoxyCodeLine{00327\ \textcolor{keywordtype}{int}\ getNumParamsRead(SpatialParams\ *spatialParams)\ \ \{}
\DoxyCodeLine{00328\ \ \ \textcolor{keywordflow}{return}\ spatialParams-\/>numParamsRead;}
\DoxyCodeLine{00329\ \}}
\DoxyCodeLine{00330\ }
\DoxyCodeLine{00331\ }
\DoxyCodeLine{00332\ \textcolor{comment}{//\ Find\ parameter\ with\ given\ name\ in\ the\ parameters\ vector}}
\DoxyCodeLine{00333\ \textcolor{comment}{//\ If\ found,\ return\ index\ in\ vector,\ otherwise\ return\ -\/1}}
\DoxyCodeLine{00334\ \textcolor{keywordtype}{int}\ locateParam(SpatialParams\ *spatialParams,\ \textcolor{keywordtype}{char}\ *name)\ \ \{}
\DoxyCodeLine{00335\ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{00336\ \ \ \textcolor{keywordtype}{int}\ found;}
\DoxyCodeLine{00337\ }
\DoxyCodeLine{00338\ \ \ i\ =\ 0;}
\DoxyCodeLine{00339\ \ \ found\ =\ 0;}
\DoxyCodeLine{00340\ \ \ \textcolor{keywordflow}{while}\ (i\ <\ spatialParams-\/>numParameters\ \&\&\ !found)\ \ \{}
\DoxyCodeLine{00341\ \ \ \ \ \textcolor{keywordflow}{if}\ (strcmpIgnoreCase(name,\ spatialParams-\/>parameters[i].name)\ ==\ 0)\ \ \{}
\DoxyCodeLine{00342\ \ \ \ \ \ \ found\ =\ 1;}
\DoxyCodeLine{00343\ \ \ \ \ \}}
\DoxyCodeLine{00344\ \ \ \ \ i++;}
\DoxyCodeLine{00345\ \ \ \}}
\DoxyCodeLine{00346\ }
\DoxyCodeLine{00347\ \ \ \textcolor{keywordflow}{if}\ (found)}
\DoxyCodeLine{00348\ \ \ \ \ \textcolor{keywordflow}{return}\ (i\ -\/\ 1);}
\DoxyCodeLine{00349\ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00350\ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00351\ \}}
\DoxyCodeLine{00352\ }
\DoxyCodeLine{00353\ }
\DoxyCodeLine{00354\ \textcolor{comment}{//\ Return\ 1\ if\ parameter\ i\ has\ had\ its\ value\ set,\ 0\ otherwise}}
\DoxyCodeLine{00355\ \textcolor{keywordtype}{int}\ valueSet(SpatialParams\ *spatialParams,\ \textcolor{keywordtype}{int}\ i)\ \ \{}
\DoxyCodeLine{00356\ \ \ \textcolor{keywordflow}{return}\ (spatialParams-\/>parameters[i].value\ !=\ NULL);}
\DoxyCodeLine{00357\ \}}
\DoxyCodeLine{00358\ }
\DoxyCodeLine{00359\ }
\DoxyCodeLine{00360\ }
\DoxyCodeLine{00361\ \textcolor{comment}{/*\ Return\ 1\ if\ parameter\ i\ varies\ spatially,\ 0\ if\ not}}
\DoxyCodeLine{00362\ \textcolor{comment}{\ \ \ PRE:\ 0\ <=\ i\ <\ spatialParams-\/>numParameters}}
\DoxyCodeLine{00363\ \textcolor{comment}{*/}}
\DoxyCodeLine{00364\ \textcolor{keywordtype}{int}\ isSpatial(SpatialParams\ *spatialParams,\ \textcolor{keywordtype}{int}\ i)\ \{}
\DoxyCodeLine{00365\ \ \ \textcolor{keywordflow}{return}\ (spatialParams-\/>parameters[i].numLocs\ >\ 0);}
\DoxyCodeLine{00366\ \}}
\DoxyCodeLine{00367\ }
\DoxyCodeLine{00368\ }
\DoxyCodeLine{00369\ \textcolor{comment}{/*\ Return\ 1\ if\ parameter\ i\ is\ changeable,\ 0\ if\ not}}
\DoxyCodeLine{00370\ \textcolor{comment}{\ \ \ PRE:\ 0\ <=\ i\ <\ spatialParams-\/>numParameters\ }}
\DoxyCodeLine{00371\ \textcolor{comment}{*/}}
\DoxyCodeLine{00372\ \textcolor{keywordtype}{int}\ isChangeable(SpatialParams\ *spatialParams,\ \textcolor{keywordtype}{int}\ i)\ \{}
\DoxyCodeLine{00373\ \ \ \textcolor{keywordflow}{return}\ spatialParams-\/>parameters[i].isChangeable;}
\DoxyCodeLine{00374\ \}}
\DoxyCodeLine{00375\ }
\DoxyCodeLine{00376\ }
\DoxyCodeLine{00377\ \textcolor{comment}{/*\ Check\ to\ see\ whether\ value\ is\ within\ allowable\ range\ of\ parameter\ i}}
\DoxyCodeLine{00378\ \textcolor{comment}{\ \ \ Return\ 1\ if\ okay,\ 0\ if\ bad}}
\DoxyCodeLine{00379\ \textcolor{comment}{*/}}
\DoxyCodeLine{00380\ \textcolor{keywordtype}{int}\ checkSpatialParam(SpatialParams\ *spatialParams,\ \textcolor{keywordtype}{int}\ i,\ \textcolor{keywordtype}{double}\ value)\ \{}
\DoxyCodeLine{00381\ \ \ \textcolor{keywordflow}{return}\ (value\ >=\ getSpatialParamMin(spatialParams,\ i)\ \&\&\ value\ <=\ getSpatialParamMax(spatialParams,\ i));}
\DoxyCodeLine{00382\ \}}
\DoxyCodeLine{00383\ }
\DoxyCodeLine{00384\ }
\DoxyCodeLine{00385\ \textcolor{comment}{/*\ Return\ value\ of\ parameter\ i,\ location\ loc\ (if\ this\ parameter\ is\ non-\/spatial,\ ignore\ loc)\ }}
\DoxyCodeLine{00386\ \textcolor{comment}{\ \ \ PRE:\ 0\ <=\ i\ <\ spatialParams-\/>numParameters}}
\DoxyCodeLine{00387\ \textcolor{comment}{\ \ \ \ \ \ \ \ if\ this\ parameter\ is\ spatial,\ then\ 0\ <=\ loc\ <\ spatialParams-\/>numLocs}}
\DoxyCodeLine{00388\ \textcolor{comment}{*/}}
\DoxyCodeLine{00389\ \textcolor{keywordtype}{double}\ getSpatialParam(SpatialParams\ *spatialParams,\ \textcolor{keywordtype}{int}\ i,\ \textcolor{keywordtype}{int}\ loc)\ \{}
\DoxyCodeLine{00390\ \ \ \textcolor{keywordflow}{return}\ getPossiblySpatial(spatialParams-\/>parameters[i].value,\ loc,\ isSpatial(spatialParams,\ i));}
\DoxyCodeLine{00391\ \}}
\DoxyCodeLine{00392\ }
\DoxyCodeLine{00393\ }
\DoxyCodeLine{00394\ \textcolor{comment}{/*\ Set\ parameter\ i,\ location\ loc\ to\ have\ given\ value}}
\DoxyCodeLine{00395\ \textcolor{comment}{\ \ \ If\ parameter\ is\ non-\/spatial,\ ignore\ loc}}
\DoxyCodeLine{00396\ \textcolor{comment}{\ \ \ If\ loc\ =\ -\/1,\ set\ this\ parameter\ at\ ALL\ LOCATIONS\ to\ have\ given\ value}}
\DoxyCodeLine{00397\ \textcolor{comment}{\ \ \ PRE:\ 0\ <=\ i\ <\ spatialParams-\/>numParameters}}
\DoxyCodeLine{00398\ \textcolor{comment}{\ \ \ \ \ \ \ \ if\ this\ parameter\ is\ spatial,\ then\ -\/1\ <=\ loc\ <\ spatialParams-\/>numLocs}}
\DoxyCodeLine{00399\ \textcolor{comment}{*/}}
\DoxyCodeLine{00400\ \textcolor{keywordtype}{void}\ setSpatialParam(SpatialParams\ *spatialParams,\ \textcolor{keywordtype}{int}\ i,\ \textcolor{keywordtype}{int}\ loc,\ \textcolor{keywordtype}{double}\ value)\ \{}
\DoxyCodeLine{00401\ \ \ setPossiblySpatial(spatialParams-\/>parameters[i].value,\ loc,\ value,\ isSpatial(spatialParams,\ i),\ spatialParams-\/>numLocs);}
\DoxyCodeLine{00402\ \}}
\DoxyCodeLine{00403\ }
\DoxyCodeLine{00404\ }
\DoxyCodeLine{00405\ \textcolor{comment}{/*\ Return\ guess\ value\ of\ parameter\ i,\ location\ loc\ (if\ this\ parameter\ is\ non-\/spatial,\ ignore\ loc)}}
\DoxyCodeLine{00406\ \textcolor{comment}{\ \ \ PRE:\ 0\ <=\ i\ <\ spatialParams-\/>numParameters}}
\DoxyCodeLine{00407\ \textcolor{comment}{\ \ \ \ \ \ \ \ if\ this\ parameter\ is\ spatial,\ then\ 0\ <=\ loc\ <\ spatialParams-\/>numLocs}}
\DoxyCodeLine{00408\ \textcolor{comment}{*/}}
\DoxyCodeLine{00409\ \textcolor{keywordtype}{double}\ getSpatialParamGuess(SpatialParams\ *spatialParams,\ \textcolor{keywordtype}{int}\ i,\ \textcolor{keywordtype}{int}\ loc)\ \{}
\DoxyCodeLine{00410\ \ \ \textcolor{keywordflow}{return}\ getPossiblySpatial(spatialParams-\/>parameters[i].guess,\ loc,\ isSpatial(spatialParams,\ i));}
\DoxyCodeLine{00411\ \}}
\DoxyCodeLine{00412\ }
\DoxyCodeLine{00413\ }
\DoxyCodeLine{00414\ \textcolor{comment}{/*\ Return\ min.\ value\ of\ range\ of\ parameter\ i\ (note:\ this\ is\ constant\ across\ space)}}
\DoxyCodeLine{00415\ \textcolor{comment}{\ \ \ PRE:\ 0\ <=\ i\ <\ spatialParams-\/>numParameters}}
\DoxyCodeLine{00416\ \textcolor{comment}{*/}}
\DoxyCodeLine{00417\ \textcolor{keywordtype}{double}\ getSpatialParamMin(SpatialParams\ *spatialParams,\ \textcolor{keywordtype}{int}\ i)\ \{}
\DoxyCodeLine{00418\ \ \ \textcolor{keywordflow}{return}\ spatialParams-\/>parameters[i].min;}
\DoxyCodeLine{00419\ \}}
\DoxyCodeLine{00420\ }
\DoxyCodeLine{00421\ }
\DoxyCodeLine{00422\ \textcolor{comment}{/*\ Return\ max.\ value\ of\ range\ of\ parameter\ i\ (note:\ this\ is\ constant\ across\ space)}}
\DoxyCodeLine{00423\ \textcolor{comment}{\ \ \ PRE:\ 0\ <=\ i\ <\ spatialParams-\/>numParameters}}
\DoxyCodeLine{00424\ \textcolor{comment}{*/}}
\DoxyCodeLine{00425\ \textcolor{keywordtype}{double}\ getSpatialParamMax(SpatialParams\ *spatialParams,\ \textcolor{keywordtype}{int}\ i)\ \{}
\DoxyCodeLine{00426\ \ \ \textcolor{keywordflow}{return}\ spatialParams-\/>parameters[i].max;}
\DoxyCodeLine{00427\ \}}
\DoxyCodeLine{00428\ }
\DoxyCodeLine{00429\ }
\DoxyCodeLine{00430\ \textcolor{comment}{/*\ Return\ sigma\ value\ of\ parameter\ i\ (note:\ this\ is\ constant\ across\ space)}}
\DoxyCodeLine{00431\ \textcolor{comment}{\ \ \ PRE:\ 0\ <=\ i\ <\ spatialParams-\/>numParameters}}
\DoxyCodeLine{00432\ \textcolor{comment}{*/}}
\DoxyCodeLine{00433\ \textcolor{keywordtype}{double}\ getSpatialParamSigma(SpatialParams\ *spatialParams,\ \textcolor{keywordtype}{int}\ i)\ \{}
\DoxyCodeLine{00434\ \ \ \textcolor{keywordflow}{return}\ spatialParams-\/>parameters[i].sigma;}
\DoxyCodeLine{00435\ \}}
\DoxyCodeLine{00436\ }
\DoxyCodeLine{00437\ }
\DoxyCodeLine{00438\ \textcolor{comment}{/*\ Return\ knob\ value\ of\ parameter\ i,\ location\ loc\ (if\ this\ parameter\ is\ non-\/spatial,\ ignore\ loc)}}
\DoxyCodeLine{00439\ \textcolor{comment}{\ \ \ PRE:\ 0\ <=\ i\ <\ spatialParams-\/>numParameters}}
\DoxyCodeLine{00440\ \textcolor{comment}{\ \ \ \ \ \ \ \ if\ this\ parameter\ is\ spatial,\ then\ 0\ <=\ loc\ <\ spatialParams-\/>numLocs}}
\DoxyCodeLine{00441\ \textcolor{comment}{*/}}
\DoxyCodeLine{00442\ \textcolor{keywordtype}{double}\ getSpatialParamKnob(SpatialParams\ *spatialParams,\ \textcolor{keywordtype}{int}\ i,\ \textcolor{keywordtype}{int}\ loc)\ \{}
\DoxyCodeLine{00443\ \ \ \textcolor{keywordflow}{return}\ getPossiblySpatial(spatialParams-\/>parameters[i].knob,\ loc,\ isSpatial(spatialParams,\ i));}
\DoxyCodeLine{00444\ \}}
\DoxyCodeLine{00445\ }
\DoxyCodeLine{00446\ }
\DoxyCodeLine{00447\ \textcolor{comment}{/*\ Set\ "{}knob"{}\ of\ parameter\ i,\ location\ loc\ to\ have\ given\ value}}
\DoxyCodeLine{00448\ \textcolor{comment}{\ \ \ If\ parameter\ is\ non-\/spatial,\ ignore\ loc}}
\DoxyCodeLine{00449\ \textcolor{comment}{\ \ \ If\ loc\ =\ -\/1,\ set\ knob\ value\ of\ this\ parameter\ at\ ALL\ LOCATIONS\ to\ have\ given\ value}}
\DoxyCodeLine{00450\ \textcolor{comment}{\ \ \ PRE:\ 0\ <=\ i\ <\ spatialParams-\/>numParameters}}
\DoxyCodeLine{00451\ \textcolor{comment}{\ \ \ \ \ \ \ \ if\ this\ parameter\ is\ spatial,\ then\ -\/1\ <=\ loc\ <\ spatialParams-\/>numLocs}}
\DoxyCodeLine{00452\ \textcolor{comment}{*/}}
\DoxyCodeLine{00453\ \textcolor{keywordtype}{void}\ setSpatialParamKnob(SpatialParams\ *spatialParams,\ \textcolor{keywordtype}{int}\ i,\ \textcolor{keywordtype}{int}\ loc,\ \textcolor{keywordtype}{double}\ value)\ \{}
\DoxyCodeLine{00454\ \ \ setPossiblySpatial(spatialParams-\/>parameters[i].knob,\ loc,\ value,\ isSpatial(spatialParams,\ i),\ spatialParams-\/>numLocs);}
\DoxyCodeLine{00455\ \}}
\DoxyCodeLine{00456\ }
\DoxyCodeLine{00457\ }
\DoxyCodeLine{00458\ \textcolor{comment}{/*\ Return\ best\ value\ of\ parameter\ i,\ location\ loc\ (if\ this\ parameter\ is\ non-\/spatial,\ ignore\ loc)}}
\DoxyCodeLine{00459\ \textcolor{comment}{\ \ \ PRE:\ 0\ <=\ i\ <\ spatialParams-\/>numParameters}}
\DoxyCodeLine{00460\ \textcolor{comment}{\ \ \ \ \ \ \ \ if\ this\ parameter\ is\ spatial,\ then\ 0\ <=\ loc\ <\ spatialParams-\/>numLocs}}
\DoxyCodeLine{00461\ \textcolor{comment}{*/}}
\DoxyCodeLine{00462\ \textcolor{keywordtype}{double}\ getSpatialParamBest(SpatialParams\ *spatialParams,\ \textcolor{keywordtype}{int}\ i,\ \textcolor{keywordtype}{int}\ loc)\ \{}
\DoxyCodeLine{00463\ \ \ \textcolor{keywordflow}{return}\ getPossiblySpatial(spatialParams-\/>parameters[i].best,\ loc,\ isSpatial(spatialParams,\ i));}
\DoxyCodeLine{00464\ \}}
\DoxyCodeLine{00465\ }
\DoxyCodeLine{00466\ }
\DoxyCodeLine{00467\ \textcolor{comment}{/*\ Set\ best\ value\ of\ parameter\ i,\ location\ loc\ to\ have\ given\ value}}
\DoxyCodeLine{00468\ \textcolor{comment}{\ \ \ If\ parameter\ is\ non-\/spatial,\ ignore\ loc}}
\DoxyCodeLine{00469\ \textcolor{comment}{\ \ \ If\ loc\ =\ -\/1,\ set\ best\ value\ of\ this\ parameter\ at\ ALL\ LOCATIONS\ to\ have\ given\ value}}
\DoxyCodeLine{00470\ \textcolor{comment}{\ \ \ PRE:\ 0\ <=\ i\ <\ spatialParams-\/>numParameters}}
\DoxyCodeLine{00471\ \textcolor{comment}{\ \ \ \ \ \ \ \ if\ this\ parameter\ is\ spatial,\ then\ -\/1\ <=\ loc\ <\ spatialParams-\/>numLocs}}
\DoxyCodeLine{00472\ \textcolor{comment}{*/}}
\DoxyCodeLine{00473\ \textcolor{keywordtype}{void}\ setSpatialParamBest(SpatialParams\ *spatialParams,\ \textcolor{keywordtype}{int}\ i,\ \textcolor{keywordtype}{int}\ loc,\ \textcolor{keywordtype}{double}\ value)\ \{}
\DoxyCodeLine{00474\ \ \ setPossiblySpatial(spatialParams-\/>parameters[i].best,\ loc,\ value,\ isSpatial(spatialParams,\ i),\ spatialParams-\/>numLocs);}
\DoxyCodeLine{00475\ \}}
\DoxyCodeLine{00476\ }
\DoxyCodeLine{00477\ }
\DoxyCodeLine{00478\ \textcolor{comment}{/*\ Set\ best\ value\ of\ all\ parameters\ at\ given\ location\ to\ be\ equal\ to\ their\ current\ value}}
\DoxyCodeLine{00479\ \textcolor{comment}{\ \ \ \ (Note:\ ignores\ parameters\ that\ were\ never\ read\ in)}}
\DoxyCodeLine{00480\ \textcolor{comment}{\ \ \ If\ loc\ =\ -\/1,\ set\ best\ value\ of\ all\ parameters\ at\ ALL\ locations\ to\ be\ equal\ to\ their\ current\ value}}
\DoxyCodeLine{00481\ \textcolor{comment}{*/}}
\DoxyCodeLine{00482\ \textcolor{keywordtype}{void}\ setAllSpatialParamBests(SpatialParams\ *spatialParams,\ \textcolor{keywordtype}{int}\ loc)\ \{}
\DoxyCodeLine{00483\ \ \ \textcolor{keywordtype}{int}\ numParams;}
\DoxyCodeLine{00484\ \ \ \textcolor{keywordtype}{int}\ firstLoc,\ lastLoc;}
\DoxyCodeLine{00485\ \ \ \textcolor{keywordtype}{int}\ i,\ currLoc;}
\DoxyCodeLine{00486\ \ \ \textcolor{keywordtype}{double}\ value;}
\DoxyCodeLine{00487\ }
\DoxyCodeLine{00488\ \ \ numParams\ =\ spatialParams-\/>numParameters;}
\DoxyCodeLine{00489\ \ \ \textcolor{keywordflow}{if}\ (loc\ ==\ -\/1)\ \{\ \textcolor{comment}{//\ set\ best\ at\ all\ locations}}
\DoxyCodeLine{00490\ \ \ \ \ firstLoc\ =\ 0;}
\DoxyCodeLine{00491\ \ \ \ \ lastLoc\ =\ spatialParams-\/>numLocs\ -\/\ 1;}
\DoxyCodeLine{00492\ \ \ \}}
\DoxyCodeLine{00493\ \ \ \textcolor{keywordflow}{else}\ \textcolor{comment}{//\ set\ best\ at\ a\ single\ location}}
\DoxyCodeLine{00494\ \ \ \ \ firstLoc\ =\ lastLoc\ =\ loc;}
\DoxyCodeLine{00495\ }
\DoxyCodeLine{00496\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ numParams;\ i++)\ \{}
\DoxyCodeLine{00497\ \ \ \ \ \textcolor{keywordflow}{if}\ (valueSet(spatialParams,\ i))\ \{\ \ \textcolor{comment}{//\ if\ valueSet\ is\ false,\ ignore\ this\ parameter\ (it\ was\ never\ read\ in)}}
\DoxyCodeLine{00498\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (isSpatial(spatialParams,\ i))\ \{}
\DoxyCodeLine{00499\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (currLoc\ =\ firstLoc;\ currLoc\ <=\ lastLoc;\ currLoc++)\ \{}
\DoxyCodeLine{00500\ \ \ \ \ \ \ \ \ \ \ value\ =\ getSpatialParam(spatialParams,\ i,\ currLoc);}
\DoxyCodeLine{00501\ \ \ \ \ \ \ \ \ \ \ setSpatialParamBest(spatialParams,\ i,\ currLoc,\ value);}
\DoxyCodeLine{00502\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00503\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00504\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{\ \textcolor{comment}{//\ non-\/spatial}}
\DoxyCodeLine{00505\ \ \ \ \ \ \ \ \ value\ =\ getSpatialParam(spatialParams,\ i,\ 0);}
\DoxyCodeLine{00506\ \ \ \ \ \ \ \ \ setSpatialParamBest(spatialParams,\ i,\ 0,\ value);}
\DoxyCodeLine{00507\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00508\ \ \ \ \ \}}
\DoxyCodeLine{00509\ \ \ \}}
\DoxyCodeLine{00510\ \}}
\DoxyCodeLine{00511\ }
\DoxyCodeLine{00512\ }
\DoxyCodeLine{00513\ \textcolor{comment}{/*\ Return\ the\ index\ (into\ spatialParams-\/>parameters)\ of\ a\ randomly-\/chosen\ spatial\ parameter\ that\ is\ changeable\ }}
\DoxyCodeLine{00514\ \textcolor{comment}{\ \ \ PRE:\ random\ number\ generator\ has\ been\ seeded}}
\DoxyCodeLine{00515\ \textcolor{comment}{*/}}
\DoxyCodeLine{00516\ \textcolor{keywordtype}{int}\ randomChangeableSpatialParam(SpatialParams\ *spatialParams)\ \{}
\DoxyCodeLine{00517\ \ \ \textcolor{keywordtype}{int}\ rnd;\ }
\DoxyCodeLine{00518\ }
\DoxyCodeLine{00519\ \ \ rnd\ =\ (int)\ floor(spatialParams-\/>numChangeableParams\ *\ (rand()*1.0/(RAND\_MAX\ +\ 1.0)));\ \textcolor{comment}{//\ 0\ <=\ rnd\ <\ spatialParams-\/>numChangeableParams}}
\DoxyCodeLine{00520\ }
\DoxyCodeLine{00521\ \ \ \textcolor{keywordflow}{return}\ spatialParams-\/>changeableParamIndices[rnd];\ }
\DoxyCodeLine{00522\ \}}
\DoxyCodeLine{00523\ }
\DoxyCodeLine{00524\ }
\DoxyCodeLine{00525\ \textcolor{comment}{/*\ Load\ spatial\ parameters\ into\ memory\ locations\ pointed\ to\ by\ paramPtrs}}
\DoxyCodeLine{00526\ \textcolor{comment}{\ \ \ For\ spatially-\/varying\ parameters,\ load\ value\ at\ location\ given\ by\ loc}}
\DoxyCodeLine{00527\ \textcolor{comment}{\ \ \ (Purpose:\ load\ all\ parameters\ into\ a\ localized\ structure\ for\ a\ model\ run,\ to\ make\ the\ model\ run\ more\ efficient)}}
\DoxyCodeLine{00528\ \textcolor{comment}{\ \ \ }}
\DoxyCodeLine{00529\ \textcolor{comment}{\ \ \ PRE:\ spatialParams-\/>parameters\ is\ loaded\ with\ param.\ values\ (particularly,\ at\ given\ location)}}
\DoxyCodeLine{00530\ \textcolor{comment}{\ \ \ \ \ \ \ \ externalLoc\ pointers\ have\ been\ set\ for\ each\ parameter}}
\DoxyCodeLine{00531\ \textcolor{comment}{\ \ \ \ \ \ \ \ 0\ <=\ loc\ <\ spatialParams-\/>numLocs}}
\DoxyCodeLine{00532\ \textcolor{comment}{*/}}
\DoxyCodeLine{00533\ \textcolor{keywordtype}{void}\ loadSpatialParams(SpatialParams\ *spatialParams,\ \textcolor{keywordtype}{int}\ loc)\ \{}
\DoxyCodeLine{00534\ \ \ \textcolor{keywordtype}{int}\ i,\ numParams;}
\DoxyCodeLine{00535\ \ \ \textcolor{keywordtype}{double}\ value;}
\DoxyCodeLine{00536\ }
\DoxyCodeLine{00537\ \ \ numParams\ =\ spatialParams-\/>numParameters;}
\DoxyCodeLine{00538\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ numParams;\ i++)\ \{}
\DoxyCodeLine{00539\ \ \ \ \ \textcolor{comment}{//\ externalLoc\ will\ equal\ NULL\ if\ it\ was\ assigned\ to\ NULL\ in\ readOneSpatialParam}}
\DoxyCodeLine{00540\ \ \ \ \ \textcolor{keywordflow}{if}\ (valueSet(spatialParams,\ i)\ \&\&\ spatialParams-\/>parameters[i].externalLoc\ !=\ NULL)\ \{\ }
\DoxyCodeLine{00541\ \ \ \ \ \ \ value\ =\ getSpatialParam(spatialParams,\ i,\ loc);}
\DoxyCodeLine{00542\ \ \ \ \ \ \ *(spatialParams-\/>parameters[i].externalLoc)\ =\ value;\ \textcolor{comment}{//\ copy\ value\ into\ location\ pointed\ to\ by\ this\ externalLoc}}
\DoxyCodeLine{00543\ \ \ \ \ \}}
\DoxyCodeLine{00544\ \ \ \}}
\DoxyCodeLine{00545\ \}}
\DoxyCodeLine{00546\ }
\DoxyCodeLine{00547\ }
\DoxyCodeLine{00548\ \textcolor{comment}{/*\ If\ randomReset\ =\ 0,\ set\ values\ of\ all\ parameters\ to\ be\ equal\ to\ guess\ values}}
\DoxyCodeLine{00549\ \textcolor{comment}{\ \ \ If\ randomReset\ non-\/zero,\ set\ parameter\ values\ to\ be\ somewhere\ (chosen\ uniform\ randomly)\ between\ min\ and\ max}}
\DoxyCodeLine{00550\ \textcolor{comment}{\ \ \ \ -\/\ Note\ that\ non-\/changeable\ parameters\ will\ still\ be\ set\ to\ their\ guess\ values,\ though}}
\DoxyCodeLine{00551\ \textcolor{comment}{\ \ \ \ (Note:\ ignores\ parameters\ that\ were\ never\ read\ in)}}
\DoxyCodeLine{00552\ \textcolor{comment}{\ \ \ (If\ randomReset\ non-\/zero,\ random\ number\ generator\ must\ have\ been\ seeded)}}
\DoxyCodeLine{00553\ \textcolor{comment}{\ \ \ Set\ best\ values\ of\ all\ parameters\ to\ be\ equal\ to\ current\ values}}
\DoxyCodeLine{00554\ \textcolor{comment}{\ \ \ Set\ knobs\ of\ all\ parameters\ to\ be\ equal\ to\ knob\ argument}}
\DoxyCodeLine{00555\ \textcolor{comment}{*/}}
\DoxyCodeLine{00556\ \textcolor{keywordtype}{void}\ resetSpatialParams(SpatialParams\ *spatialParams,\ \textcolor{keywordtype}{double}\ knob,\ \textcolor{keywordtype}{int}\ randomReset)\ \{}
\DoxyCodeLine{00557\ \ \ \textcolor{keywordtype}{int}\ numParams,\ numLocs;}
\DoxyCodeLine{00558\ \ \ \textcolor{keywordtype}{int}\ i,\ loc;}
\DoxyCodeLine{00559\ \ \ \textcolor{keywordtype}{double}\ value;}
\DoxyCodeLine{00560\ }
\DoxyCodeLine{00561\ \ \ numParams\ =\ spatialParams-\/>numParameters;}
\DoxyCodeLine{00562\ \ \ numLocs\ =\ spatialParams-\/>numLocs;}
\DoxyCodeLine{00563\ }
\DoxyCodeLine{00564\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ numParams;\ i++)\ \{}
\DoxyCodeLine{00565\ \ \ \ \ \textcolor{keywordflow}{if}\ (valueSet(spatialParams,\ i))\ \{\ \ \textcolor{comment}{//\ if\ valueSet\ is\ false,\ ignore\ this\ parameter\ (it\ was\ never\ read\ in)}}
\DoxyCodeLine{00566\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (isSpatial(spatialParams,\ i))\ \{}
\DoxyCodeLine{00567\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (loc\ =\ 0;\ loc\ <\ numLocs;\ loc++)\ \{}
\DoxyCodeLine{00568\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((randomReset\ ==\ 0)\ ||\ !isChangeable(spatialParams,\ i))\ \textcolor{comment}{//\ non-\/random:\ use\ guess\ value}}
\DoxyCodeLine{00569\ \ \ \ \ \ \ \ \ \ \ \ \ value\ =\ getSpatialParamGuess(spatialParams,\ i,\ loc);}
\DoxyCodeLine{00570\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{comment}{//\ random:\ set\ parameter\ value\ to\ be\ somewhere\ between\ min\ and\ max}}
\DoxyCodeLine{00571\ \ \ \ \ \ \ \ \ \ \ \ \ value\ =\ getSpatialParamMin(spatialParams,\ i)\ +\ (getSpatialParamMax(spatialParams,\ i)\ -\/\ getSpatialParamMin(spatialParams,\ i))\ }
\DoxyCodeLine{00572\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *\ ((\textcolor{keywordtype}{float})rand()/RAND\_MAX);}
\DoxyCodeLine{00573\ \ \ \ \ \ \ \ \ \ \ setSpatialParam(spatialParams,\ i,\ loc,\ value);}
\DoxyCodeLine{00574\ \ \ \ \ \ \ \ \ \ \ setSpatialParamBest(spatialParams,\ i,\ loc,\ value);}
\DoxyCodeLine{00575\ \ \ \ \ \ \ \ \ \ \ setSpatialParamKnob(spatialParams,\ i,\ loc,\ knob);}
\DoxyCodeLine{00576\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00577\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00578\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{\ \textcolor{comment}{//\ non-\/spatial}}
\DoxyCodeLine{00579\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((randomReset\ ==\ 0)\ ||\ !isChangeable(spatialParams,\ i))\ \textcolor{comment}{//\ non-\/random:\ use\ guess\ value}}
\DoxyCodeLine{00580\ \ \ \ \ \ \ \ \ \ \ value\ =\ getSpatialParamGuess(spatialParams,\ i,\ 0);}
\DoxyCodeLine{00581\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{comment}{//\ random:\ set\ parameter\ value\ to\ be\ somewhere\ between\ min\ and\ max}}
\DoxyCodeLine{00582\ \ \ \ \ \ \ \ \ \ \ value\ =\ getSpatialParamMin(spatialParams,\ i)\ +\ (getSpatialParamMax(spatialParams,\ i)\ -\/\ getSpatialParamMin(spatialParams,\ i))}
\DoxyCodeLine{00583\ \ \ \ \ \ \ \ \ \ \ \ \ *\ ((\textcolor{keywordtype}{float})rand()/RAND\_MAX);}
\DoxyCodeLine{00584\ \ \ \ \ \ \ \ \ setSpatialParam(spatialParams,\ i,\ 0,\ value);}
\DoxyCodeLine{00585\ \ \ \ \ \ \ \ \ setSpatialParamBest(spatialParams,\ i,\ 0,\ value);}
\DoxyCodeLine{00586\ \ \ \ \ \ \ \ \ setSpatialParamKnob(spatialParams,\ i,\ 0,\ knob);}
\DoxyCodeLine{00587\ \ \ \ \ \ \ \}\ \textcolor{comment}{//\ else\ non-\/spatial}}
\DoxyCodeLine{00588\ \ \ \ \ \}\ \textcolor{comment}{//\ if\ valueSet}}
\DoxyCodeLine{00589\ \ \ \}\ \textcolor{comment}{//\ for\ i}}
\DoxyCodeLine{00590\ \}\ \textcolor{comment}{//\ resetSpatialParams}}
\DoxyCodeLine{00591\ }
\DoxyCodeLine{00592\ }
\DoxyCodeLine{00593\ \textcolor{comment}{/*\ Write\ best\ parameter\ values,\ and\ other\ parameter\ info,\ to\ files\ }}
\DoxyCodeLine{00594\ \textcolor{comment}{\ \ \ \ (only\ write\ parameters\ that\ were\ read\ in,\ and\ in\ the\ same\ order\ that\ they\ were\ read\ in)}}
\DoxyCodeLine{00595\ \textcolor{comment}{\ \ \ Note\ that\ other\ parameter\ info\ won't\ have\ changed\ since\ the\ read\ -\/\ we\ just\ copy\ that\ over}}
\DoxyCodeLine{00596\ \textcolor{comment}{\ \ \ Write\ all\ parameter\ info\ to\ file\ with\ name\ *paramFile,\ and\ spatially-\/varying\ parameter\ values\ to\ file\ with\ name\ *spatialParamFile}}
\DoxyCodeLine{00597\ \textcolor{comment}{\ \ \ See\ readSpatialParams\ for\ file\ formats}}
\DoxyCodeLine{00598\ \textcolor{comment}{*/}}
\DoxyCodeLine{00599\ \textcolor{keywordtype}{void}\ writeBestSpatialParams(SpatialParams\ *spatialParams,\ \textcolor{keywordtype}{char}\ *paramFile,\ \textcolor{keywordtype}{char}\ *spatialParamFile)\ \{}
\DoxyCodeLine{00600\ \ \ FILE\ *paramF,\ *spatialParamF;}
\DoxyCodeLine{00601\ \ \ \textcolor{keywordtype}{int}\ numParamsRead,\ numLocs;}
\DoxyCodeLine{00602\ \ \ \textcolor{keywordtype}{int}\ i,\ j,\ index;}
\DoxyCodeLine{00603\ }
\DoxyCodeLine{00604\ \ \ paramF\ =\ openFile(paramFile,\ \textcolor{stringliteral}{"{}w"{}});}
\DoxyCodeLine{00605\ \ \ spatialParamF\ =\ openFile(spatialParamFile,\ \textcolor{stringliteral}{"{}w"{}});}
\DoxyCodeLine{00606\ }
\DoxyCodeLine{00607\ \ \ numParamsRead\ =\ getNumParamsRead(spatialParams);}
\DoxyCodeLine{00608\ \ \ numLocs\ =\ spatialParams-\/>numLocs;}
\DoxyCodeLine{00609\ }
\DoxyCodeLine{00610\ \ \ fprintf(spatialParamF,\ \textcolor{stringliteral}{"{}\%d\(\backslash\)n"{}},\ numLocs);}
\DoxyCodeLine{00611\ }
\DoxyCodeLine{00612\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ numParamsRead;\ i++)\ \{\ \textcolor{comment}{//\ loop\ through\ parameters}}
\DoxyCodeLine{00613\ \ \ \ \ index\ =\ spatialParams-\/>readIndices[i];\ \textcolor{comment}{//\ allows\ us\ to\ just\ consider\ the\ parameters\ that\ were\ read\ in,\ in\ the\ proper\ order}}
\DoxyCodeLine{00614\ \ \ \ \ fprintf(paramF,\ \textcolor{stringliteral}{"{}\%s\(\backslash\)t"{}},\ spatialParams-\/>parameters[index].name);}
\DoxyCodeLine{00615\ \ \ \ \ \textcolor{keywordflow}{if}\ (isSpatial(spatialParams,\ index))\ \{\ }
\DoxyCodeLine{00616\ \ \ \ \ \ \ fprintf(paramF,\ \textcolor{stringliteral}{"{}*\(\backslash\)t"{}});\ \textcolor{comment}{//\ write\ "{}*"{}\ in\ place\ of\ value,\ then\ write\ values\ to\ spatialParamFile}}
\DoxyCodeLine{00617\ \ \ \ \ \ \ fprintf(spatialParamF,\ \textcolor{stringliteral}{"{}\%s"{}},\ spatialParams-\/>parameters[index].name);}
\DoxyCodeLine{00618\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (j\ =\ 0;\ j\ <\ numLocs;\ j++)\ \textcolor{comment}{//\ loop\ through\ locations}}
\DoxyCodeLine{00619\ \ \ \ \ \ \ \ \ fprintf(spatialParamF,\ \textcolor{stringliteral}{"{}\(\backslash\)t\%f"{}},\ getSpatialParamBest(spatialParams,\ index,\ j));}
\DoxyCodeLine{00620\ \ \ \ \ \ \ fprintf(spatialParamF,\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{00621\ \ \ \ \ \}}
\DoxyCodeLine{00622\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{comment}{//\ non-\/spatial:\ write\ value}}
\DoxyCodeLine{00623\ \ \ \ \ \ \ fprintf(paramF,\ \textcolor{stringliteral}{"{}\%f\(\backslash\)t"{}},\ getSpatialParamBest(spatialParams,\ index,\ 0));}
\DoxyCodeLine{00624\ }
\DoxyCodeLine{00625\ \ \ \ \ \textcolor{comment}{//\ now\ write\ other\ info\ to\ file\ (other\ info\ is\ always\ non-\/spatial):}}
\DoxyCodeLine{00626\ \ \ \ \ fprintf(paramF,\ \textcolor{stringliteral}{"{}\%d\(\backslash\)t\%f\(\backslash\)t\%f\(\backslash\)t\%f\(\backslash\)n"{}},\ isChangeable(spatialParams,\ index),\ getSpatialParamMin(spatialParams,index),}
\DoxyCodeLine{00627\ \ \ \ \ \ \ \ \ \ \ \ \ getSpatialParamMax(spatialParams,\ index),\ getSpatialParamSigma(spatialParams,\ index));}
\DoxyCodeLine{00628\ \ \ \}}
\DoxyCodeLine{00629\ }
\DoxyCodeLine{00630\ \ \ fclose(paramF);}
\DoxyCodeLine{00631\ \ \ fclose(spatialParamF);}
\DoxyCodeLine{00632\ \}}
\DoxyCodeLine{00633\ \ \ \ \ }
\DoxyCodeLine{00634\ }
\DoxyCodeLine{00635\ \textcolor{comment}{/*\ Write\ name,\ guess,\ min\ \&\ max,\ value,\ best\ and\ knob\ of\ each\ changeable\ param\ to\ file}}
\DoxyCodeLine{00636\ \textcolor{comment}{\ \ \ \ (only\ write\ parameters\ that\ were\ read\ in,\ and\ in\ the\ same\ order\ that\ they\ were\ read\ in)}}
\DoxyCodeLine{00637\ \textcolor{comment}{\ \ \ If\ loc\ >=\ 0,\ write\ info\ for\ that\ location;\ if\ loc\ =\ -\/1,\ write\ value\ at\ location\ 0,\ and\ append\ a\ *\ to\ spatial\ parameter\ values}}
\DoxyCodeLine{00638\ \textcolor{comment}{\ \ \ PRE:\ outF\ is\ open\ for\ writing}}
\DoxyCodeLine{00639\ \textcolor{comment}{*/}}
\DoxyCodeLine{00640\ \textcolor{keywordtype}{void}\ writeChangeableParamInfo(SpatialParams\ *spatialParams,\ \textcolor{keywordtype}{int}\ loc,\ FILE\ *outF)\ \{}
\DoxyCodeLine{00641\ \ \ \textcolor{keywordtype}{int}\ i,\ index,\ numParamsRead,\ count;}
\DoxyCodeLine{00642\ \ \ \textcolor{keywordtype}{int}\ theLoc;\ \textcolor{comment}{//\ location\ that\ we're\ printing\ info\ for}}
\DoxyCodeLine{00643\ \ \ \textcolor{keywordtype}{char}\ appendage[2];}
\DoxyCodeLine{00644\ }
\DoxyCodeLine{00645\ \ \ \textcolor{keywordflow}{if}\ (loc\ ==\ -\/1)}
\DoxyCodeLine{00646\ \ \ \ \ theLoc\ =\ 0;}
\DoxyCodeLine{00647\ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00648\ \ \ \ \ theLoc\ =\ loc;}
\DoxyCodeLine{00649\ }
\DoxyCodeLine{00650\ \ \ numParamsRead\ =\ getNumParamsRead(spatialParams);}
\DoxyCodeLine{00651\ \ \ count\ =\ 0;\ \textcolor{comment}{//\ count\ of\ changeable\ parameters}}
\DoxyCodeLine{00652\ \ \ fprintf(outF,\ \textcolor{stringliteral}{"{}Changeable\ Parameters:\(\backslash\)n"{}});}
\DoxyCodeLine{00653\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ numParamsRead;\ i++)\ \{}
\DoxyCodeLine{00654\ \ \ \ \ index\ =\ spatialParams-\/>readIndices[i];\ \textcolor{comment}{//\ allows\ us\ to\ just\ consider\ the\ parameters\ that\ were\ read\ in,\ in\ the\ proper\ order}}
\DoxyCodeLine{00655\ \ \ \ \ \textcolor{keywordflow}{if}\ (isChangeable(spatialParams,\ index))\ \{}
\DoxyCodeLine{00656\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (loc\ ==\ -\/1\ \&\&\ isSpatial(spatialParams,\ index))\ \textcolor{comment}{//\ we'll\ append\ a\ *\ to\ spatially-\/varying\ values}}
\DoxyCodeLine{00657\ \ \ \ \ \ \ \ \ strcpy(appendage,\ \textcolor{stringliteral}{"{}*"{}});}
\DoxyCodeLine{00658\ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00659\ \ \ \ \ \ \ \ \ strcpy(appendage,\ \textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{00660\ }
\DoxyCodeLine{00661\ \ \ \ \ \ \ fprintf(outF,\ \textcolor{stringliteral}{"{}[\%d]\ \%s:\(\backslash\)t"{}},\ count,\ spatialParams-\/>parameters[index].name);}
\DoxyCodeLine{00662\ \ \ \ \ \ \ fprintf(outF,\ \textcolor{stringliteral}{"{}Value\ =\ \%f\%s\(\backslash\)t"{}},\ getSpatialParam(spatialParams,\ index,\ theLoc),\ appendage);}
\DoxyCodeLine{00663\ \ \ \ \ \ \ fprintf(outF,\ \textcolor{stringliteral}{"{}Best\ =\ \%f\%s\(\backslash\)t"{}},\ getSpatialParamBest(spatialParams,\ index,\ theLoc),\ appendage);}
\DoxyCodeLine{00664\ \ \ \ \ \ \ fprintf(outF,\ \textcolor{stringliteral}{"{}Knob\ =\ \%f\%s\(\backslash\)t"{}},\ getSpatialParamKnob(spatialParams,\ index,\ theLoc),\ appendage);}
\DoxyCodeLine{00665\ \ \ \ \ \ \ fprintf(outF,\ \textcolor{stringliteral}{"{}Prior:\ \%f\%s\ "{}},\ getSpatialParamGuess(spatialParams,\ index,\ theLoc),\ appendage);}
\DoxyCodeLine{00666\ \ \ \ \ \ \ fprintf(outF,\ \textcolor{stringliteral}{"{}\ [\%f,\ \%f]\(\backslash\)n"{}},\ getSpatialParamMin(spatialParams,\ index),\ getSpatialParamMax(spatialParams,\ index));}
\DoxyCodeLine{00667\ }
\DoxyCodeLine{00668\ \ \ \ \ \ \ count++;}
\DoxyCodeLine{00669\ \ \ \ \ \}}
\DoxyCodeLine{00670\ \ \ \}}
\DoxyCodeLine{00671\ \}}
\DoxyCodeLine{00672\ }
\DoxyCodeLine{00673\ }
\DoxyCodeLine{00674\ \textcolor{comment}{//\ Clean\ up:\ deallocate\ spatialParams\ and\ any\ other\ dynamically-\/allocated\ pointers\ that\ need\ deallocating}}
\DoxyCodeLine{00675\ \textcolor{keywordtype}{void}\ deleteSpatialParams(SpatialParams\ *spatialParams)\ \{}
\DoxyCodeLine{00676\ \ \ \textcolor{keywordtype}{int}\ numParameters,\ i;}
\DoxyCodeLine{00677\ \ \ OneSpatialParam\ *param;}
\DoxyCodeLine{00678\ }
\DoxyCodeLine{00679\ \ \ \textcolor{comment}{//\ first\ loop\ through\ individual\ parameters,\ de-\/allocating\ space\ they\ use:}}
\DoxyCodeLine{00680\ \ \ numParameters\ =\ spatialParams-\/>numParameters;}
\DoxyCodeLine{00681\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ numParameters;\ i++)\ \{}
\DoxyCodeLine{00682\ \ \ \ \ param\ =\ \&(spatialParams-\/>parameters[i]);}
\DoxyCodeLine{00683\ \ \ \ \ \textcolor{keywordflow}{if}\ (param-\/>value\ !=\ NULL)\ \{\ \textcolor{comment}{//\ this\ parameter\ has\ been\ used\ -\/\ so\ space\ has\ been\ allocated\ for\ its\ various\ values}}
\DoxyCodeLine{00684\ \ \ \ \ \ \ free(param-\/>value);}
\DoxyCodeLine{00685\ \ \ \ \ \ \ free(param-\/>guess);}
\DoxyCodeLine{00686\ \ \ \ \ \ \ free(param-\/>best);}
\DoxyCodeLine{00687\ \ \ \ \ \ \ free(param-\/>knob);}
\DoxyCodeLine{00688\ \ \ \ \ \}}
\DoxyCodeLine{00689\ \ \ \}}
\DoxyCodeLine{00690\ }
\DoxyCodeLine{00691\ \ \ \textcolor{comment}{//\ now\ free\ space\ used\ by\ spatialParams\ structure\ itself:}}
\DoxyCodeLine{00692\ \ \ free(spatialParams-\/>parameters);}
\DoxyCodeLine{00693\ \ \ free(spatialParams-\/>readIndices);}
\DoxyCodeLine{00694\ \ \ free(spatialParams-\/>changeableParamIndices);}
\DoxyCodeLine{00695\ \ \ free(spatialParams);}
\DoxyCodeLine{00696\ \}}
\DoxyCodeLine{00697\ }
\DoxyCodeLine{00698\ }
\DoxyCodeLine{00699\ \ \ }

\end{DoxyCode}
